<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Supplementary topics | Egocentric network analysis with R</title>
  <meta name="description" content="Personal network analysis with R" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Supplementary topics | Egocentric network analysis with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Personal network analysis with R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Supplementary topics | Egocentric network analysis with R" />
  
  <meta name="twitter:description" content="Personal network analysis with R" />
  

<meta name="author" content="Raffaele Vacca" />


<meta name="date" content="2024-02-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="egor.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Contents</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#setup"><i class="fa fa-check"></i><b>1.1</b> Workshop setup</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#materials"><i class="fa fa-check"></i><b>1.2</b> Workshop materials</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#r-settings"><i class="fa fa-check"></i><b>1.3</b> R settings</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#packages"><i class="fa fa-check"></i><b>1.3.1</b> Required R packages</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#rstudio-options"><i class="fa fa-check"></i><b>1.3.2</b> RStudio options</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#data"><i class="fa fa-check"></i><b>1.4</b> Data</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#author-and-contacts"><i class="fa fa-check"></i><b>1.5</b> Author and contacts</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> R basics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="basics.html"><a href="basics.html#overview"><i class="fa fa-check"></i><b>2.1</b> Overview</a></li>
<li class="chapter" data-level="2.2" data-path="basics.html"><a href="basics.html#starting-R-and-loading-packages"><i class="fa fa-check"></i><b>2.2</b> Starting R and loading packages</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="basics.html"><a href="basics.html#console-vs-scripts"><i class="fa fa-check"></i><b>2.2.1</b> Console vs scripts</a></li>
<li class="chapter" data-level="2.2.2" data-path="basics.html"><a href="basics.html#getting-help"><i class="fa fa-check"></i><b>2.2.2</b> Getting help</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="basics.html"><a href="basics.html#objects-in-r"><i class="fa fa-check"></i><b>2.3</b> Objects in R</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="basics.html"><a href="basics.html#the-workspace"><i class="fa fa-check"></i><b>2.3.1</b> The workspace</a></li>
<li class="chapter" data-level="2.3.2" data-path="basics.html"><a href="basics.html#saving-and-removing-objects"><i class="fa fa-check"></i><b>2.3.2</b> Saving and removing objects</a></li>
<li class="chapter" data-level="2.3.3" data-path="basics.html"><a href="basics.html#vector-and-matrix-objects"><i class="fa fa-check"></i><b>2.3.3</b> Vector and matrix objects</a></li>
<li class="chapter" data-level="2.3.4" data-path="basics.html"><a href="basics.html#dataframes"><i class="fa fa-check"></i><b>2.3.4</b> Data frames</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="basics.html"><a href="basics.html#arithmetic-statistical-and-relational-operations"><i class="fa fa-check"></i><b>2.4</b> Arithmetic, statistical, and relational operations</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="basics.html"><a href="basics.html#arithmetic-operations-and-recycling"><i class="fa fa-check"></i><b>2.4.1</b> Arithmetic operations and recycling</a></li>
<li class="chapter" data-level="2.4.2" data-path="basics.html"><a href="basics.html#relational-operations-and-logical-vectors"><i class="fa fa-check"></i><b>2.4.2</b> Relational operations and logical vectors</a></li>
<li class="chapter" data-level="2.4.3" data-path="basics.html"><a href="basics.html#examples-of-arithmetic-and-statistical-functions"><i class="fa fa-check"></i><b>2.4.3</b> Examples of arithmetic and statistical functions</a></li>
<li class="chapter" data-level="2.4.4" data-path="basics.html"><a href="basics.html#missing-and-infinite-values"><i class="fa fa-check"></i><b>2.4.4</b> Missing and infinite values</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="basics.html"><a href="basics.html#subsetting"><i class="fa fa-check"></i><b>2.5</b> Subsetting</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="basics.html"><a href="basics.html#index-df"><i class="fa fa-check"></i><b>2.5.1</b> Subsetting data frames</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="basics.html"><a href="basics.html#the-tidyverse-syntax"><i class="fa fa-check"></i><b>2.6</b> The <code>tidyverse</code> syntax</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="basics.html"><a href="basics.html#pipes-and-the-operator"><i class="fa fa-check"></i><b>2.6.1</b> Pipes and the <code>|&gt;</code> operator</a></li>
<li class="chapter" data-level="2.6.2" data-path="basics.html"><a href="basics.html#subsetting-data-frames-in-tidyverse"><i class="fa fa-check"></i><b>2.6.2</b> Subsetting data frames in <code>tidyverse</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="represent.html"><a href="represent.html"><i class="fa fa-check"></i><b>3</b> Representing and visualizing ego-networks</a>
<ul>
<li class="chapter" data-level="3.1" data-path="represent.html"><a href="represent.html#overview-1"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="represent.html"><a href="represent.html#egocentric-data"><i class="fa fa-check"></i><b>3.2</b> Ego-level and alter-level data</a></li>
<li class="chapter" data-level="3.3" data-path="represent.html"><a href="represent.html#networks-in-r"><i class="fa fa-check"></i><b>3.3</b> Networks in R</a></li>
<li class="chapter" data-level="3.4" data-path="represent.html"><a href="represent.html#ego-networks-as-igraph-objects"><i class="fa fa-check"></i><b>3.4</b> Ego-networks as <code>igraph</code> objects</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="composition.html"><a href="composition.html"><i class="fa fa-check"></i><b>4</b> Ego-network composition</a>
<ul>
<li class="chapter" data-level="4.1" data-path="composition.html"><a href="composition.html#overview-2"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="composition.html"><a href="composition.html#measures-of-ego-network-composition"><i class="fa fa-check"></i><b>4.2</b> Measures of ego-network composition</a></li>
<li class="chapter" data-level="4.3" data-path="composition.html"><a href="composition.html#comp-many"><i class="fa fa-check"></i><b>4.3</b> Analyzing the composition of many ego-networks</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="composition.html"><a href="composition.html#split-apply-combine-in-egocentric-network-analysis"><i class="fa fa-check"></i><b>4.3.1</b> Split-apply-combine in egocentric network analysis</a></li>
<li class="chapter" data-level="4.3.2" data-path="composition.html"><a href="composition.html#summarize-dplyr"><i class="fa fa-check"></i><b>4.3.2</b> Grouping and summarizing with <code>dplyr</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="structure.html"><a href="structure.html"><i class="fa fa-check"></i><b>5</b> Ego-network structure</a>
<ul>
<li class="chapter" data-level="5.1" data-path="structure.html"><a href="structure.html#overview-3"><i class="fa fa-check"></i><b>5.1</b> Overview</a></li>
<li class="chapter" data-level="5.2" data-path="structure.html"><a href="structure.html#measures-of-ego-network-structure"><i class="fa fa-check"></i><b>5.2</b> Measures of ego-network structure</a></li>
<li class="chapter" data-level="5.3" data-path="structure.html"><a href="structure.html#lists"><i class="fa fa-check"></i><b>5.3</b> R lists</a></li>
<li class="chapter" data-level="5.4" data-path="structure.html"><a href="structure.html#apply-purrr"><i class="fa fa-check"></i><b>5.4</b> Analyzing the structure of many ego-networks</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multilevel.html"><a href="multilevel.html"><i class="fa fa-check"></i><b>6</b> Multilevel modeling of ego-network data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="multilevel.html"><a href="multilevel.html#resources"><i class="fa fa-check"></i><b>6.1</b> Resources</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="multilevel.html"><a href="multilevel.html#multilevel-models-for-egocentric-network-data"><i class="fa fa-check"></i><b>6.1.1</b> Multilevel models for egocentric network data</a></li>
<li class="chapter" data-level="6.1.2" data-path="multilevel.html"><a href="multilevel.html#multilevel-modeling-in-general"><i class="fa fa-check"></i><b>6.1.2</b> Multilevel modeling in general</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="multilevel.html"><a href="multilevel.html#prepare-the-data"><i class="fa fa-check"></i><b>6.2</b> Prepare the data</a></li>
<li class="chapter" data-level="6.3" data-path="multilevel.html"><a href="multilevel.html#random-intercept-models"><i class="fa fa-check"></i><b>6.3</b> Random intercept models</a></li>
<li class="chapter" data-level="6.4" data-path="multilevel.html"><a href="multilevel.html#random-slope-models"><i class="fa fa-check"></i><b>6.4</b> Random slope models</a></li>
<li class="chapter" data-level="6.5" data-path="multilevel.html"><a href="multilevel.html#tests-of-significance"><i class="fa fa-check"></i><b>6.5</b> Tests of significance</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="egor.html"><a href="egor.html"><i class="fa fa-check"></i><b>7</b> The <code>egor</code> package</a>
<ul>
<li class="chapter" data-level="7.1" data-path="egor.html"><a href="egor.html#egor-import"><i class="fa fa-check"></i><b>7.1</b> Importing ego-network data</a></li>
<li class="chapter" data-level="7.2" data-path="egor.html"><a href="egor.html#analyzing-and-visualizing-ego-network-data"><i class="fa fa-check"></i><b>7.2</b> Analyzing and visualizing ego-network data</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="supplementary.html"><a href="supplementary.html"><i class="fa fa-check"></i><b>8</b> Supplementary topics</a>
<ul>
<li class="chapter" data-level="8.1" data-path="supplementary.html"><a href="supplementary.html#more-r-programming-topics"><i class="fa fa-check"></i><b>8.1</b> More R programming topics</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="supplementary.html"><a href="supplementary.html#types-and-classes-of-objects"><i class="fa fa-check"></i><b>8.1.1</b> Types and classes of objects</a></li>
<li class="chapter" data-level="8.1.2" data-path="supplementary.html"><a href="supplementary.html#functions"><i class="fa fa-check"></i><b>8.1.2</b> Writing your own R functions</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="supplementary.html"><a href="supplementary.html#import-igraph"><i class="fa fa-check"></i><b>8.2</b> Importing ego-network data with <code>igraph</code> and <code>tidyverse</code></a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="supplementary.html"><a href="supplementary.html#importing-data-for-one-ego-network"><i class="fa fa-check"></i><b>8.2.1</b> Importing data for one ego-network</a></li>
<li class="chapter" data-level="8.2.2" data-path="supplementary.html"><a href="supplementary.html#importing-data-on-many-ego-networks-as-data-frames-and-lists"><i class="fa fa-check"></i><b>8.2.2</b> Importing data on many ego-networks as data frames and lists</a></li>
<li class="chapter" data-level="8.2.3" data-path="supplementary.html"><a href="supplementary.html#creating-lists-of-ego-networks-as-igraph-objects-with-purrr"><i class="fa fa-check"></i><b>8.2.3</b> Creating lists of ego-networks as <code>igraph</code> objects with <code>purrr</code></a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="supplementary.html"><a href="supplementary.html#more-igraph"><i class="fa fa-check"></i><b>8.3</b> More operations with <code>igraph</code></a></li>
<li class="chapter" data-level="8.4" data-path="supplementary.html"><a href="supplementary.html#statnet"><i class="fa fa-check"></i><b>8.4</b> The <code>statnet</code> suite of packages</a></li>
<li class="chapter" data-level="8.5" data-path="supplementary.html"><a href="supplementary.html#illustrative-example-personal-networks-of-sri-lankan-immigrants-in-italy"><i class="fa fa-check"></i><b>8.5</b> Illustrative example: personal networks of Sri Lankan immigrants in Italy</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Egocentric network analysis with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="supplementary" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> Supplementary topics<a href="supplementary.html#supplementary" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="more-r-programming-topics" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> More R programming topics<a href="supplementary.html#more-r-programming-topics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="types-and-classes-of-objects" class="section level3 hasAnchor" number="8.1.1">
<h3><span class="header-section-number">8.1.1</span> Types and classes of objects<a href="supplementary.html#types-and-classes-of-objects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is a quick summary of the basics about <strong>types</strong> and <strong>classes</strong> of objects in R.</p>
<ul>
<li><p>Three functions are used to know what kind of object you are dealing with in R: <code>class()</code>, <code>mode()</code>, and <code>typeof()</code>.</p></li>
<li><p>For most purposes, you only need to know what the <strong>class</strong> of an object is. This is returned by <code>class()</code>. The class of an object determines what R functions you can or cannot run on that object, and how functions will behave when you run them on the object. In particular, if the function has a <code>method</code> for a specific class <em>A</em> of objects, it will use that method whenever an object of class <em>A</em> is given as its argument.</p></li>
<li><p><code>typeof()</code> and <code>mode()</code> return the <strong>type</strong> and <strong>mode</strong> of an object, respectively. Although they refer to slightly different classifications of objects, type and mode give essentially the same kind of information — the type of data structure in which the object is stored, also called the R “internal type” or “storage mode”. For example, an object can be internally stored in R as double-precision numbers, integer numbers, or character strings.</p>
<ul>
<li>You should prefer <code>typeof()</code> over <code>mode()</code>. <code>mode()</code> refers to the old S classification of types and is mostly used for S compatibility.</li>
</ul></li>
<li><p>While most times all you need to know is the <code>class</code> of an object, there are a few cases in which knowing the <code>type</code> is useful too. For example, you may want to know the <code>type</code> of a matrix object (whose <code>class</code> is always <code>matrix</code>) to check if the values in the matrix are being stored as numbers or character strings (that will affect the result of some functions).</p></li>
<li><p>Main classes/types of objects</p>
<ul>
<li><code>numeric</code>: Numerical data (integer, real or complex numbers).</li>
<li><code>logical</code>: <code>TRUE/FALSE</code> data.</li>
<li><code>character</code>: String data.</li>
<li><code>factor</code>: Categorical data, that is, integer numbers with string labels attached. May be <em>unordered</em> factors (nominal data) or <em>ordered</em> factors (ordinal data).</li>
</ul></li>
<li><p>Special and complex classes/types</p>
<ul>
<li><code>list</code>: A collection of elements of any type, including numeric, character, logical (see Section <a href="structure.html#lists">5.3</a>).</li>
<li><code>data.frame</code>: A dataset. In R, a data frame is a special kind of list (its type is <code>list</code> but its class is <code>data.frame</code>), where each variable (column) is a list element (see Section <a href="basics.html#dataframes">2.3.4</a>)</li>
<li><code>matrix</code>: Matrix values can be numeric, character, logical etc. So an object can have <code>matrix</code> as class and <code>numeric</code>, <code>character</code> or <code>logical</code> as type. While data frames can contain variables of different type (e.g. a character variable and a numeric variable), matrices can only contain values of <em>one</em> type.</li>
<li>Functions (more on this in Section <a href="supplementary.html#functions">8.1.2</a>).</li>
<li>Expressions.</li>
<li>Formulas.</li>
<li>Other objects: Statistical results (e.g. linear model estimates), dendrograms, graphics objects, etc.</li>
</ul></li>
<li><p>Relevant functions</p>
<ul>
<li><code>class()</code>, <code>typeof()</code> and <code>mode()</code>, as discussed above.</li>
<li><code>is.</code><em>type</em> functions verify that an object is in a specific type or class: e.g. <code>is.numeric(x)</code>, <code>is.character(x)</code> (they return <code>TRUE</code> or <code>FALSE</code>).</li>
<li><code>as.</code><em>type</em> functions convert objects between types or classes: e.g. <code>as.numeric()</code>, <code>as.character()</code>. If the conversion is impossible, the result is <code>NA</code>: e.g. <code>as.numeric("abc")</code> returns <code>NA</code>.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="supplementary.html#cb500-1" tabindex="-1"></a><span class="co"># A numeric vector of integers.</span></span>
<span id="cb500-2"><a href="supplementary.html#cb500-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span></span>
<span id="cb500-3"><a href="supplementary.html#cb500-3" tabindex="-1"></a></span>
<span id="cb500-4"><a href="supplementary.html#cb500-4" tabindex="-1"></a><span class="co"># Let&#39;s check the class and type.</span></span>
<span id="cb500-5"><a href="supplementary.html#cb500-5" tabindex="-1"></a><span class="fu">class</span>(n)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="supplementary.html#cb502-1" tabindex="-1"></a><span class="fu">typeof</span>(n)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="supplementary.html#cb504-1" tabindex="-1"></a><span class="co"># A character object.</span></span>
<span id="cb504-2"><a href="supplementary.html#cb504-2" tabindex="-1"></a>(char <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;f&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot;</code></pre>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="supplementary.html#cb506-1" tabindex="-1"></a><span class="co"># Class and type.</span></span>
<span id="cb506-2"><a href="supplementary.html#cb506-2" tabindex="-1"></a><span class="fu">class</span>(char)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="supplementary.html#cb508-1" tabindex="-1"></a><span class="fu">typeof</span>(char)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="supplementary.html#cb510-1" tabindex="-1"></a><span class="co"># Let&#39;s put n in a matrix.</span></span>
<span id="cb510-2"><a href="supplementary.html#cb510-2" tabindex="-1"></a>(M <span class="ot">&lt;-</span> <span class="fu">matrix</span>(n, <span class="at">nrow=</span><span class="dv">10</span>, <span class="at">ncol=</span><span class="dv">10</span>))</span></code></pre></div>
<pre><code>##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
##  [1,]    1   11   21   31   41   51   61   71   81    91
##  [2,]    2   12   22   32   42   52   62   72   82    92
##  [3,]    3   13   23   33   43   53   63   73   83    93
##  [4,]    4   14   24   34   44   54   64   74   84    94
##  [5,]    5   15   25   35   45   55   65   75   85    95
##  [6,]    6   16   26   36   46   56   66   76   86    96
##  [7,]    7   17   27   37   47   57   67   77   87    97
##  [8,]    8   18   28   38   48   58   68   78   88    98
##  [9,]    9   19   29   39   49   59   69   79   89    99
## [10,]   10   20   30   40   50   60   70   80   90   100</code></pre>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="supplementary.html#cb512-1" tabindex="-1"></a><span class="co"># Class/type of this object.</span></span>
<span id="cb512-2"><a href="supplementary.html#cb512-2" tabindex="-1"></a><span class="fu">class</span>(M)</span></code></pre></div>
<pre><code>## [1] &quot;matrix&quot; &quot;array&quot;</code></pre>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="supplementary.html#cb514-1" tabindex="-1"></a><span class="co"># Type and mode tell us that this is an *integer* matrix.</span></span>
<span id="cb514-2"><a href="supplementary.html#cb514-2" tabindex="-1"></a><span class="fu">typeof</span>(M)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="supplementary.html#cb516-1" tabindex="-1"></a><span class="co"># There are character and logical matrices too.</span></span>
<span id="cb516-2"><a href="supplementary.html#cb516-2" tabindex="-1"></a>char</span></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot;</code></pre>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="supplementary.html#cb518-1" tabindex="-1"></a>(C <span class="ot">&lt;-</span> <span class="fu">matrix</span>(char, <span class="at">nrow=</span><span class="dv">3</span>, <span class="at">ncol=</span> <span class="dv">2</span>))</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,] &quot;a&quot;  &quot;d&quot; 
## [2,] &quot;b&quot;  &quot;e&quot; 
## [3,] &quot;c&quot;  &quot;f&quot;</code></pre>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="supplementary.html#cb520-1" tabindex="-1"></a><span class="co"># Class and type.</span></span>
<span id="cb520-2"><a href="supplementary.html#cb520-2" tabindex="-1"></a><span class="fu">class</span>(C)</span></code></pre></div>
<pre><code>## [1] &quot;matrix&quot; &quot;array&quot;</code></pre>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="supplementary.html#cb522-1" tabindex="-1"></a><span class="fu">typeof</span>(C)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="supplementary.html#cb524-1" tabindex="-1"></a><span class="co"># Notice that a matrix can contain numbers but still be stored as character.</span></span>
<span id="cb524-2"><a href="supplementary.html#cb524-2" tabindex="-1"></a>(M <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;4&quot;</span>), <span class="at">nrow=</span><span class="dv">2</span>, <span class="at">ncol=</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,] &quot;1&quot;  &quot;3&quot; 
## [2,] &quot;2&quot;  &quot;4&quot;</code></pre>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="supplementary.html#cb526-1" tabindex="-1"></a><span class="fu">class</span>(M)</span></code></pre></div>
<pre><code>## [1] &quot;matrix&quot; &quot;array&quot;</code></pre>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="supplementary.html#cb528-1" tabindex="-1"></a><span class="fu">typeof</span>(M)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="supplementary.html#cb530-1" tabindex="-1"></a><span class="co"># Let&#39;s convert &quot;char&quot; to factor.</span></span>
<span id="cb530-2"><a href="supplementary.html#cb530-2" tabindex="-1"></a>char</span></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot;</code></pre>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="supplementary.html#cb532-1" tabindex="-1"></a>(char <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(char))</span></code></pre></div>
<pre><code>## [1] a b c d e f
## Levels: a b c d e f</code></pre>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="supplementary.html#cb534-1" tabindex="-1"></a><span class="co"># This means that now char is not just a collection of strings, it is a</span></span>
<span id="cb534-2"><a href="supplementary.html#cb534-2" tabindex="-1"></a><span class="co"># categorical variable in R&#39;s mind: it is a collection of numbers with character</span></span>
<span id="cb534-3"><a href="supplementary.html#cb534-3" tabindex="-1"></a><span class="co"># labels attached.</span></span>
<span id="cb534-4"><a href="supplementary.html#cb534-4" tabindex="-1"></a></span>
<span id="cb534-5"><a href="supplementary.html#cb534-5" tabindex="-1"></a><span class="co"># Compare the different behavior of as.numeric(): char as character...</span></span>
<span id="cb534-6"><a href="supplementary.html#cb534-6" tabindex="-1"></a>(char <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;f&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot;</code></pre>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="supplementary.html#cb536-1" tabindex="-1"></a><span class="co"># Convert to numeric</span></span>
<span id="cb536-2"><a href="supplementary.html#cb536-2" tabindex="-1"></a><span class="fu">as.numeric</span>(char)</span></code></pre></div>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<pre><code>## [1] NA NA NA NA NA NA</code></pre>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="supplementary.html#cb539-1" tabindex="-1"></a><span class="co"># ...versus char as factor.</span></span>
<span id="cb539-2"><a href="supplementary.html#cb539-2" tabindex="-1"></a>char <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;f&quot;</span>)</span>
<span id="cb539-3"><a href="supplementary.html#cb539-3" tabindex="-1"></a>(char <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(char))</span></code></pre></div>
<pre><code>## [1] a b c d e f
## Levels: a b c d e f</code></pre>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="supplementary.html#cb541-1" tabindex="-1"></a><span class="fu">as.numeric</span>(char)</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5 6</code></pre>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="supplementary.html#cb543-1" tabindex="-1"></a><span class="co"># char is a different object in R&#39;s mind when it&#39;s character vs when</span></span>
<span id="cb543-2"><a href="supplementary.html#cb543-2" tabindex="-1"></a><span class="co"># it&#39;s factor. Characters can&#39;t be converted to numbers,</span></span>
<span id="cb543-3"><a href="supplementary.html#cb543-3" tabindex="-1"></a><span class="co"># but factors can.</span></span>
<span id="cb543-4"><a href="supplementary.html#cb543-4" tabindex="-1"></a></span>
<span id="cb543-5"><a href="supplementary.html#cb543-5" tabindex="-1"></a><span class="co"># ***** EXERCISE: </span></span>
<span id="cb543-6"><a href="supplementary.html#cb543-6" tabindex="-1"></a><span class="co"># Using &quot;as.factor()&quot;, convert the &quot;educ&quot; object to factor. Assign the</span></span>
<span id="cb543-7"><a href="supplementary.html#cb543-7" tabindex="-1"></a><span class="co"># result to &quot;educ.fc&quot;. Print both &quot;educ&quot; and &quot;educ.fc&quot;. Do you notice any</span></span>
<span id="cb543-8"><a href="supplementary.html#cb543-8" tabindex="-1"></a><span class="co"># difference in the way they are printed? Convert &quot;educ&quot; and &quot;educ.fc&quot; to</span></span>
<span id="cb543-9"><a href="supplementary.html#cb543-9" tabindex="-1"></a><span class="co"># numeric. Why is the result different?</span></span>
<span id="cb543-10"><a href="supplementary.html#cb543-10" tabindex="-1"></a><span class="co"># *****</span></span></code></pre></div>
</div>
<div id="functions" class="section level3 hasAnchor" number="8.1.2">
<h3><span class="header-section-number">8.1.2</span> Writing your own R functions<a href="supplementary.html#functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>One of the most powerful tools in R is the ability to <strong>write your own functions</strong>.</li>
<li>A function is a <strong>piece of code</strong> that operates on one or multiple <strong>arguments</strong> (the <em>input</em>), and returns an <em>output</em> (the function <strong>value</strong> in R terminology). Everything that happens in R is done by a function.</li>
<li>Many R functions have <strong>default values</strong> for their arguments: if you don’t specify the argument’s value, the function will use the default.</li>
<li>Once you write a function and define its arguments, you can run that function on any argument values you want — provided that the function code actually works on those argument values. For example, if a function takes an <code>igraph</code> object as an argument, you’ll be able to run that function on any network you like, provided that the network is an <code>igraph</code> object. If your network is a <code>network</code> object (created by a <code>statnet</code> function), the function will likely return an error.</li>
<li>R functions, combined with <a href="https://adv-r.hadley.nz/functionals.html">functional</a> and summarization methods such as those seen in Sections <a href="composition.html#comp-many">4.3</a> and <a href="structure.html#apply-purrr">5.4</a>, are the best way to run exactly the same code on many different objects (for example, many different ego-networks). Functions are <strong>crucial for code reproducibility</strong> in R. If you write functions, you won’t need to re-write (copy and paste) the same code over and over again — you just write it once in the function, then run the function any time and on any arguments you need. This yields clearer, shorter, more readable code with less errors.</li>
<li>New functions are also commonly used to <strong>redefine existing functions</strong> by pre-setting the value of specific arguments. For example, if you want all your plots to have <code>red</code> as color, you can take R’s existing plotting function <code>plot</code>, and wrap it in a new function that always executes <code>plot</code> with the argument <code>col="red"</code>. Your function would be something like <code>my.plot &lt;- function(...) {plot(..., col="red")}</code> (examples below).</li>
<li><strong>Tips and tricks</strong> with functions:
<ul>
<li><code>stopifnot()</code> is useful to check that function arguments are of the type that was intended by the function author. It stops the function if a certain condition is not met by a function argument (e.g. argument is <em>not</em> an <code>igraph</code> object, if the function was written for <code>igraph</code> objects).</li>
<li><code>return()</code> allows you to explicitly set the output that the function will return (clearer code). It is also used to stop function execution earlier under certain conditions. Note: If you don’t use <code>return()</code>, the function value (output) is the last object that is printed at the end of the function code.</li>
<li><code>if</code> is a flow control tool that is frequently used within functions: it specifies what the function should do <code>if</code> a certain condition is met at one point.</li>
<li>First think particular, then generalize. When you want to write a function, it’s a good idea to first try the code on a “real”, specific existing object in your workspace. If the code does what you want on that object, you can then wrap it into a general function to be run on any similar object (see examples in the code below).</li>
</ul></li>
<li>In ego-network analysis, we often want to write functions that calculate measures of ego-network composition and structure that we are interested in. These functions will have different arguments depending on whether they look at network composition or structure:
<ul>
<li>Functions that calculate compositional measures typically require just the alter attribute data frame as argument.</li>
<li>Functions that calculate structural measures require the ego-network as an <code>igraph</code> object (or <code>network</code> object in <code>statnet</code>), which store the alter-alter tie information.</li>
<li>Functions that calculate measures combining composition and structure require the <code>igraph</code> object, with alter attributes incorporated in the object as vertex attributes.</li>
</ul></li>
<li><strong>What we do in the following code</strong>.
<ul>
<li>Demonstrate the basics of R functions using simple examples.</li>
<li>Consider some of the compositional and structural measures we calculated in previous chapters, and convert them to general functions that can be applied to any ego-network: average closeness of alters; proportion of female alters; proportion of alters of the same gender as ego; function that returns multiple compositional measures into a data frame; maximum alter betweenness; number of components and isolates in the ego-network; tie density between alters who live in Sri Lanka.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="supplementary.html#cb544-1" tabindex="-1"></a><span class="co"># Basics of R functions</span></span>
<span id="cb544-2"><a href="supplementary.html#cb544-2" tabindex="-1"></a><span class="co"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - </span></span>
<span id="cb544-3"><a href="supplementary.html#cb544-3" tabindex="-1"></a></span>
<span id="cb544-4"><a href="supplementary.html#cb544-4" tabindex="-1"></a><span class="co"># Any piece of code you can write and run in R, you can also put in a function.</span></span>
<span id="cb544-5"><a href="supplementary.html#cb544-5" tabindex="-1"></a></span>
<span id="cb544-6"><a href="supplementary.html#cb544-6" tabindex="-1"></a><span class="co"># Let&#39;s write a trivial function that takes its argument and multiplies it by 2.</span></span>
<span id="cb544-7"><a href="supplementary.html#cb544-7" tabindex="-1"></a>times2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb544-8"><a href="supplementary.html#cb544-8" tabindex="-1"></a>  x<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb544-9"><a href="supplementary.html#cb544-9" tabindex="-1"></a>}</span>
<span id="cb544-10"><a href="supplementary.html#cb544-10" tabindex="-1"></a></span>
<span id="cb544-11"><a href="supplementary.html#cb544-11" tabindex="-1"></a><span class="co"># Now we can run the function on any argument.</span></span>
<span id="cb544-12"><a href="supplementary.html#cb544-12" tabindex="-1"></a><span class="fu">times2</span>(<span class="at">x=</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 6</code></pre>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="supplementary.html#cb546-1" tabindex="-1"></a><span class="fu">times2</span>(<span class="at">x=</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 20</code></pre>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="supplementary.html#cb548-1" tabindex="-1"></a><span class="fu">times2</span>(<span class="dv">50</span>)</span></code></pre></div>
<pre><code>## [1] 100</code></pre>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="supplementary.html#cb550-1" tabindex="-1"></a><span class="co"># A function that takes its argument and prints a sentence with it:</span></span>
<span id="cb550-2"><a href="supplementary.html#cb550-2" tabindex="-1"></a>myoutput <span class="ot">&lt;-</span> <span class="cf">function</span>(word) {</span>
<span id="cb550-3"><a href="supplementary.html#cb550-3" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;My output is&quot;</span>, word))</span>
<span id="cb550-4"><a href="supplementary.html#cb550-4" tabindex="-1"></a>}</span>
<span id="cb550-5"><a href="supplementary.html#cb550-5" tabindex="-1"></a></span>
<span id="cb550-6"><a href="supplementary.html#cb550-6" tabindex="-1"></a><span class="co"># Let&#39;s run the function.</span></span>
<span id="cb550-7"><a href="supplementary.html#cb550-7" tabindex="-1"></a><span class="fu">myoutput</span>(<span class="st">&quot;cat&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;My output is cat&quot;</code></pre>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="supplementary.html#cb552-1" tabindex="-1"></a><span class="fu">myoutput</span>(<span class="at">word=</span> <span class="st">&quot;table&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;My output is table&quot;</code></pre>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="supplementary.html#cb554-1" tabindex="-1"></a><span class="fu">myoutput</span>(<span class="st">&quot;any word here&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;My output is any word here&quot;</code></pre>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="supplementary.html#cb556-1" tabindex="-1"></a><span class="co"># Not necessarily a useful function...</span></span>
<span id="cb556-2"><a href="supplementary.html#cb556-2" tabindex="-1"></a></span>
<span id="cb556-3"><a href="supplementary.html#cb556-3" tabindex="-1"></a><span class="co"># Note that the function output is the last object that is printed at the end</span></span>
<span id="cb556-4"><a href="supplementary.html#cb556-4" tabindex="-1"></a><span class="co"># of the function code.</span></span>
<span id="cb556-5"><a href="supplementary.html#cb556-5" tabindex="-1"></a>times2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb556-6"><a href="supplementary.html#cb556-6" tabindex="-1"></a>  y <span class="ot">&lt;-</span> x<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb556-7"><a href="supplementary.html#cb556-7" tabindex="-1"></a>  y</span>
<span id="cb556-8"><a href="supplementary.html#cb556-8" tabindex="-1"></a>}</span>
<span id="cb556-9"><a href="supplementary.html#cb556-9" tabindex="-1"></a><span class="fu">times2</span>(<span class="at">x=</span><span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="supplementary.html#cb558-1" tabindex="-1"></a><span class="co"># If nothing is printed, then the function returns nothing.</span></span>
<span id="cb558-2"><a href="supplementary.html#cb558-2" tabindex="-1"></a>times2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb558-3"><a href="supplementary.html#cb558-3" tabindex="-1"></a>  y <span class="ot">&lt;-</span> x<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb558-4"><a href="supplementary.html#cb558-4" tabindex="-1"></a>}</span>
<span id="cb558-5"><a href="supplementary.html#cb558-5" tabindex="-1"></a><span class="fu">times2</span>(<span class="at">x=</span><span class="dv">4</span>)</span>
<span id="cb558-6"><a href="supplementary.html#cb558-6" tabindex="-1"></a></span>
<span id="cb558-7"><a href="supplementary.html#cb558-7" tabindex="-1"></a><span class="co"># A function will return an error if it&#39;s executed on arguments that are not</span></span>
<span id="cb558-8"><a href="supplementary.html#cb558-8" tabindex="-1"></a><span class="co"># suitable for the code inside the function. E.g., R can&#39;t multiply &quot;a&quot; by 2...</span></span>
<span id="cb558-9"><a href="supplementary.html#cb558-9" tabindex="-1"></a>times2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb558-10"><a href="supplementary.html#cb558-10" tabindex="-1"></a>  x<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb558-11"><a href="supplementary.html#cb558-11" tabindex="-1"></a>}</span>
<span id="cb558-12"><a href="supplementary.html#cb558-12" tabindex="-1"></a><span class="fu">times2</span>(<span class="at">x=</span> <span class="st">&quot;a&quot;</span>)</span></code></pre></div>
<pre><code>## Error in x * 2: non-numeric argument to binary operator</code></pre>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="supplementary.html#cb560-1" tabindex="-1"></a><span class="co"># Let&#39;s then specify that the function&#39;s argument must be numeric.</span></span>
<span id="cb560-2"><a href="supplementary.html#cb560-2" tabindex="-1"></a>times2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb560-3"><a href="supplementary.html#cb560-3" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(x))  </span>
<span id="cb560-4"><a href="supplementary.html#cb560-4" tabindex="-1"></a>  x<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb560-5"><a href="supplementary.html#cb560-5" tabindex="-1"></a>}</span>
<span id="cb560-6"><a href="supplementary.html#cb560-6" tabindex="-1"></a></span>
<span id="cb560-7"><a href="supplementary.html#cb560-7" tabindex="-1"></a><span class="co"># Let&#39;s try it now.</span></span>
<span id="cb560-8"><a href="supplementary.html#cb560-8" tabindex="-1"></a><span class="fu">times2</span>(<span class="at">x=</span> <span class="st">&quot;a&quot;</span>)</span></code></pre></div>
<pre><code>## Error in times2(x = &quot;a&quot;): is.numeric(x) is not TRUE</code></pre>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="supplementary.html#cb562-1" tabindex="-1"></a><span class="co"># This still throws and error, but it makes the error clearer to the user and </span></span>
<span id="cb562-2"><a href="supplementary.html#cb562-2" tabindex="-1"></a><span class="co"># it immidiately indicates where the problem is.</span></span>
<span id="cb562-3"><a href="supplementary.html#cb562-3" tabindex="-1"></a></span>
<span id="cb562-4"><a href="supplementary.html#cb562-4" tabindex="-1"></a><span class="co"># Using if, we can also re-write the function so that it returns NA with a</span></span>
<span id="cb562-5"><a href="supplementary.html#cb562-5" tabindex="-1"></a><span class="co"># warning if its argument is not numeric -- instead of just stopping with an</span></span>
<span id="cb562-6"><a href="supplementary.html#cb562-6" tabindex="-1"></a><span class="co"># error.</span></span>
<span id="cb562-7"><a href="supplementary.html#cb562-7" tabindex="-1"></a>times2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb562-8"><a href="supplementary.html#cb562-8" tabindex="-1"></a>  <span class="co"># If x is not numeric</span></span>
<span id="cb562-9"><a href="supplementary.html#cb562-9" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.numeric</span>(x)) {</span>
<span id="cb562-10"><a href="supplementary.html#cb562-10" tabindex="-1"></a>    <span class="co"># Give the warning</span></span>
<span id="cb562-11"><a href="supplementary.html#cb562-11" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">&quot;Your argument is not numeric!&quot;</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb562-12"><a href="supplementary.html#cb562-12" tabindex="-1"></a>    <span class="co"># Return missing value</span></span>
<span id="cb562-13"><a href="supplementary.html#cb562-13" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb562-14"><a href="supplementary.html#cb562-14" tabindex="-1"></a>    <span class="co"># Otherwise, return x*2</span></span>
<span id="cb562-15"><a href="supplementary.html#cb562-15" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb562-16"><a href="supplementary.html#cb562-16" tabindex="-1"></a>    <span class="fu">return</span>(x<span class="sc">*</span><span class="dv">2</span>)</span>
<span id="cb562-17"><a href="supplementary.html#cb562-17" tabindex="-1"></a>  }</span>
<span id="cb562-18"><a href="supplementary.html#cb562-18" tabindex="-1"></a>}</span>
<span id="cb562-19"><a href="supplementary.html#cb562-19" tabindex="-1"></a></span>
<span id="cb562-20"><a href="supplementary.html#cb562-20" tabindex="-1"></a><span class="co"># Try the function</span></span>
<span id="cb562-21"><a href="supplementary.html#cb562-21" tabindex="-1"></a><span class="fu">times2</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="supplementary.html#cb564-1" tabindex="-1"></a><span class="fu">times2</span>(<span class="st">&quot;a&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Your argument is not numeric!</code></pre>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="supplementary.html#cb567-1" tabindex="-1"></a><span class="co"># Writing functions that calculate ego-network measures</span></span>
<span id="cb567-2"><a href="supplementary.html#cb567-2" tabindex="-1"></a><span class="co"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - </span></span>
<span id="cb567-3"><a href="supplementary.html#cb567-3" tabindex="-1"></a></span>
<span id="cb567-4"><a href="supplementary.html#cb567-4" tabindex="-1"></a><span class="co"># Now that we know how to write functions, we can convert any ego-network</span></span>
<span id="cb567-5"><a href="supplementary.html#cb567-5" tabindex="-1"></a><span class="co"># measure we calculated above to a general function.</span></span>
<span id="cb567-6"><a href="supplementary.html#cb567-6" tabindex="-1"></a></span>
<span id="cb567-7"><a href="supplementary.html#cb567-7" tabindex="-1"></a><span class="co"># This is a function that takes the alter-level data frame for an ego, and</span></span>
<span id="cb567-8"><a href="supplementary.html#cb567-8" tabindex="-1"></a><span class="co"># calculates average closeness of alters.</span></span>
<span id="cb567-9"><a href="supplementary.html#cb567-9" tabindex="-1"></a>avg_alt_clo <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb567-10"><a href="supplementary.html#cb567-10" tabindex="-1"></a>  <span class="fu">mean</span>(df<span class="sc">$</span>alter.clo, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) </span>
<span id="cb567-11"><a href="supplementary.html#cb567-11" tabindex="-1"></a>}</span>
<span id="cb567-12"><a href="supplementary.html#cb567-12" tabindex="-1"></a></span>
<span id="cb567-13"><a href="supplementary.html#cb567-13" tabindex="-1"></a><span class="co"># Let&#39;s run this function on our alter data frame for ego 28</span></span>
<span id="cb567-14"><a href="supplementary.html#cb567-14" tabindex="-1"></a><span class="fu">avg_alt_clo</span>(<span class="at">df=</span> alter.attr<span class="fl">.28</span>)</span></code></pre></div>
<pre><code>## [1] 4.1</code></pre>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="supplementary.html#cb569-1" tabindex="-1"></a><span class="co"># Function that takes the alter-level data frame for an ego, and calculates</span></span>
<span id="cb569-2"><a href="supplementary.html#cb569-2" tabindex="-1"></a><span class="co"># the proportion of female alters.</span></span>
<span id="cb569-3"><a href="supplementary.html#cb569-3" tabindex="-1"></a>prop_fem <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb569-4"><a href="supplementary.html#cb569-4" tabindex="-1"></a>  <span class="fu">mean</span>(df<span class="sc">$</span>alter.sex <span class="sc">==</span> <span class="st">&quot;Female&quot;</span>) </span>
<span id="cb569-5"><a href="supplementary.html#cb569-5" tabindex="-1"></a>}</span>
<span id="cb569-6"><a href="supplementary.html#cb569-6" tabindex="-1"></a></span>
<span id="cb569-7"><a href="supplementary.html#cb569-7" tabindex="-1"></a><span class="co"># Apply the function to our data frame</span></span>
<span id="cb569-8"><a href="supplementary.html#cb569-8" tabindex="-1"></a><span class="fu">prop_fem</span>(<span class="at">df=</span> alter.attr<span class="fl">.28</span>)</span></code></pre></div>
<pre><code>## [1] 0.1777778</code></pre>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="supplementary.html#cb571-1" tabindex="-1"></a><span class="co"># Function that takes two arguments: the alter-level data frame for an ego, and</span></span>
<span id="cb571-2"><a href="supplementary.html#cb571-2" tabindex="-1"></a><span class="co"># the ego-level data frame; and calculates the proportion of alters of the same</span></span>
<span id="cb571-3"><a href="supplementary.html#cb571-3" tabindex="-1"></a><span class="co"># sex as ego.</span></span>
<span id="cb571-4"><a href="supplementary.html#cb571-4" tabindex="-1"></a>same_sex <span class="ot">&lt;-</span> <span class="cf">function</span>(df, ego.df) {</span>
<span id="cb571-5"><a href="supplementary.html#cb571-5" tabindex="-1"></a>  </span>
<span id="cb571-6"><a href="supplementary.html#cb571-6" tabindex="-1"></a>  <span class="co"># Join alter and ego attribute data.</span></span>
<span id="cb571-7"><a href="supplementary.html#cb571-7" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df, ego.df, <span class="at">by=</span> <span class="st">&quot;ego_ID&quot;</span>)</span>
<span id="cb571-8"><a href="supplementary.html#cb571-8" tabindex="-1"></a>  </span>
<span id="cb571-9"><a href="supplementary.html#cb571-9" tabindex="-1"></a>  <span class="co"># Return the measure</span></span>
<span id="cb571-10"><a href="supplementary.html#cb571-10" tabindex="-1"></a>  <span class="fu">mean</span>(df<span class="sc">$</span>alter.sex <span class="sc">==</span> df<span class="sc">$</span>ego.sex) </span>
<span id="cb571-11"><a href="supplementary.html#cb571-11" tabindex="-1"></a>}</span>
<span id="cb571-12"><a href="supplementary.html#cb571-12" tabindex="-1"></a></span>
<span id="cb571-13"><a href="supplementary.html#cb571-13" tabindex="-1"></a><span class="co"># Apply the function</span></span>
<span id="cb571-14"><a href="supplementary.html#cb571-14" tabindex="-1"></a><span class="fu">same_sex</span>(<span class="at">df=</span> alter.attr<span class="fl">.28</span>, <span class="at">ego.df=</span> ego.df)</span></code></pre></div>
<pre><code>## [1] 0.8222222</code></pre>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="supplementary.html#cb573-1" tabindex="-1"></a><span class="co"># Function that takes the alter-level data frame for an ego, and calculates</span></span>
<span id="cb573-2"><a href="supplementary.html#cb573-2" tabindex="-1"></a><span class="co"># multiple compositional measures.</span></span>
<span id="cb573-3"><a href="supplementary.html#cb573-3" tabindex="-1"></a>comp_meas <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb573-4"><a href="supplementary.html#cb573-4" tabindex="-1"></a>  df <span class="sc">|&gt;</span></span>
<span id="cb573-5"><a href="supplementary.html#cb573-5" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb573-6"><a href="supplementary.html#cb573-6" tabindex="-1"></a>      <span class="at">mean.clo =</span> <span class="fu">mean</span>(alter.clo, <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb573-7"><a href="supplementary.html#cb573-7" tabindex="-1"></a>      <span class="at">prop.fem =</span> <span class="fu">mean</span>(alter.sex<span class="sc">==</span><span class="st">&quot;Female&quot;</span>), </span>
<span id="cb573-8"><a href="supplementary.html#cb573-8" tabindex="-1"></a>      <span class="at">count.nat.slk =</span> <span class="fu">sum</span>(alter.nat<span class="sc">==</span><span class="st">&quot;Sri Lanka&quot;</span>), </span>
<span id="cb573-9"><a href="supplementary.html#cb573-9" tabindex="-1"></a>      <span class="at">count.nat.ita =</span> <span class="fu">sum</span>(alter.nat<span class="sc">==</span><span class="st">&quot;Italy&quot;</span>), </span>
<span id="cb573-10"><a href="supplementary.html#cb573-10" tabindex="-1"></a>      <span class="at">count.nat.oth =</span> <span class="fu">sum</span>(alter.nat<span class="sc">==</span><span class="st">&quot;Other&quot;</span>)</span>
<span id="cb573-11"><a href="supplementary.html#cb573-11" tabindex="-1"></a>    )</span>
<span id="cb573-12"><a href="supplementary.html#cb573-12" tabindex="-1"></a>}</span>
<span id="cb573-13"><a href="supplementary.html#cb573-13" tabindex="-1"></a></span>
<span id="cb573-14"><a href="supplementary.html#cb573-14" tabindex="-1"></a><span class="co"># Let&#39;s apply the function.</span></span>
<span id="cb573-15"><a href="supplementary.html#cb573-15" tabindex="-1"></a><span class="fu">comp_meas</span>(alter.attr<span class="fl">.28</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##   mean.clo prop.fem count.nat.slk count.nat.ita count.nat.oth
##      &lt;dbl&gt;    &lt;dbl&gt;         &lt;int&gt;         &lt;int&gt;         &lt;int&gt;
## 1      4.1    0.178            43             0             2</code></pre>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb575-1"><a href="supplementary.html#cb575-1" tabindex="-1"></a><span class="co"># Function that takes an ego-network as igraph object, and calculates max alter</span></span>
<span id="cb575-2"><a href="supplementary.html#cb575-2" tabindex="-1"></a><span class="co"># betweenness.</span></span>
<span id="cb575-3"><a href="supplementary.html#cb575-3" tabindex="-1"></a>max_betw <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x <span class="sc">|&gt;</span> igraph<span class="sc">::</span><span class="fu">betweenness</span>(<span class="at">weights =</span> <span class="cn">NA</span>) <span class="sc">|&gt;</span> <span class="fu">max</span>()</span>
<span id="cb575-4"><a href="supplementary.html#cb575-4" tabindex="-1"></a></span>
<span id="cb575-5"><a href="supplementary.html#cb575-5" tabindex="-1"></a><span class="co"># Apply to our graph.</span></span>
<span id="cb575-6"><a href="supplementary.html#cb575-6" tabindex="-1"></a><span class="fu">max_betw</span>(<span class="at">x =</span> gr)</span></code></pre></div>
<pre><code>## [1] 257.0168</code></pre>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="supplementary.html#cb577-1" tabindex="-1"></a><span class="co"># Function that takes an ego-network as igraph object, and calculates the number</span></span>
<span id="cb577-2"><a href="supplementary.html#cb577-2" tabindex="-1"></a><span class="co"># of components and the number of isolates. </span></span>
<span id="cb577-3"><a href="supplementary.html#cb577-3" tabindex="-1"></a>comp_iso <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb577-4"><a href="supplementary.html#cb577-4" tabindex="-1"></a>  </span>
<span id="cb577-5"><a href="supplementary.html#cb577-5" tabindex="-1"></a>  <span class="co"># Get N components</span></span>
<span id="cb577-6"><a href="supplementary.html#cb577-6" tabindex="-1"></a>  N.comp <span class="ot">&lt;-</span> igraph<span class="sc">::</span><span class="fu">components</span>(x)<span class="sc">$</span>no</span>
<span id="cb577-7"><a href="supplementary.html#cb577-7" tabindex="-1"></a>  </span>
<span id="cb577-8"><a href="supplementary.html#cb577-8" tabindex="-1"></a>  <span class="co"># Get N isolates</span></span>
<span id="cb577-9"><a href="supplementary.html#cb577-9" tabindex="-1"></a>  N.iso <span class="ot">&lt;-</span> <span class="fu">sum</span>(igraph<span class="sc">::</span><span class="fu">degree</span>(x)<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb577-10"><a href="supplementary.html#cb577-10" tabindex="-1"></a>  </span>
<span id="cb577-11"><a href="supplementary.html#cb577-11" tabindex="-1"></a>  <span class="co"># Return output</span></span>
<span id="cb577-12"><a href="supplementary.html#cb577-12" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">N.comp =</span> N.comp, <span class="at">N.iso=</span> N.iso)</span>
<span id="cb577-13"><a href="supplementary.html#cb577-13" tabindex="-1"></a>}</span>
<span id="cb577-14"><a href="supplementary.html#cb577-14" tabindex="-1"></a></span>
<span id="cb577-15"><a href="supplementary.html#cb577-15" tabindex="-1"></a><span class="co"># Apply the function</span></span>
<span id="cb577-16"><a href="supplementary.html#cb577-16" tabindex="-1"></a><span class="fu">comp_iso</span>(gr)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   N.comp N.iso
##    &lt;int&gt; &lt;int&gt;
## 1      1     0</code></pre>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="supplementary.html#cb579-1" tabindex="-1"></a><span class="co"># Function that takes an ego-network as igraph object, and calculates the</span></span>
<span id="cb579-2"><a href="supplementary.html#cb579-2" tabindex="-1"></a><span class="co"># density of ties among alters who live in Sri Lanka.</span></span>
<span id="cb579-3"><a href="supplementary.html#cb579-3" tabindex="-1"></a>sl_dens <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb579-4"><a href="supplementary.html#cb579-4" tabindex="-1"></a>  </span>
<span id="cb579-5"><a href="supplementary.html#cb579-5" tabindex="-1"></a>  <span class="co"># Get the vertex sequence of alters who live in Sri Lanka.</span></span>
<span id="cb579-6"><a href="supplementary.html#cb579-6" tabindex="-1"></a>  alters.sl <span class="ot">&lt;-</span> <span class="fu">V</span>(x)[alter.res<span class="sc">==</span><span class="st">&quot;Sri Lanka&quot;</span>]</span>
<span id="cb579-7"><a href="supplementary.html#cb579-7" tabindex="-1"></a>  </span>
<span id="cb579-8"><a href="supplementary.html#cb579-8" tabindex="-1"></a>  <span class="co"># Get the subgraph of those alters</span></span>
<span id="cb579-9"><a href="supplementary.html#cb579-9" tabindex="-1"></a>  sl.subg <span class="ot">&lt;-</span> <span class="fu">induced_subgraph</span>(x, <span class="at">vids =</span> alters.sl) </span>
<span id="cb579-10"><a href="supplementary.html#cb579-10" tabindex="-1"></a>  </span>
<span id="cb579-11"><a href="supplementary.html#cb579-11" tabindex="-1"></a>  <span class="co"># Return the density of this subgraph.</span></span>
<span id="cb579-12"><a href="supplementary.html#cb579-12" tabindex="-1"></a>  <span class="fu">edge_density</span>(sl.subg)</span>
<span id="cb579-13"><a href="supplementary.html#cb579-13" tabindex="-1"></a>}</span>
<span id="cb579-14"><a href="supplementary.html#cb579-14" tabindex="-1"></a></span>
<span id="cb579-15"><a href="supplementary.html#cb579-15" tabindex="-1"></a><span class="co"># Run the function on our ego-network of ego 28.</span></span>
<span id="cb579-16"><a href="supplementary.html#cb579-16" tabindex="-1"></a><span class="fu">sl_dens</span>(<span class="at">x=</span> gr)</span></code></pre></div>
<pre><code>## [1] 0.6470588</code></pre>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="supplementary.html#cb581-1" tabindex="-1"></a><span class="co"># ***** EXERCISE: </span></span>
<span id="cb581-2"><a href="supplementary.html#cb581-2" tabindex="-1"></a><span class="co"># Write a function that takes an ego&#39;s edge list as argument. The function</span></span>
<span id="cb581-3"><a href="supplementary.html#cb581-3" tabindex="-1"></a><span class="co"># returns the number of &quot;maybe&quot; edges in the corresponding personal network (use</span></span>
<span id="cb581-4"><a href="supplementary.html#cb581-4" tabindex="-1"></a><span class="co"># data frame indexing and sum()). Run this function on the edge lists of ego ID</span></span>
<span id="cb581-5"><a href="supplementary.html#cb581-5" tabindex="-1"></a><span class="co"># 47, 53 and 162. HINT: You should first try the code on one edge list from the</span></span>
<span id="cb581-6"><a href="supplementary.html#cb581-6" tabindex="-1"></a><span class="co"># list elist.all.list An edge is &quot;uncertain&quot; if the corresponding value in</span></span>
<span id="cb581-7"><a href="supplementary.html#cb581-7" tabindex="-1"></a><span class="co"># the edge list is 2. Remember that the ego IDs are in names(elist.all.list).</span></span>
<span id="cb581-8"><a href="supplementary.html#cb581-8" tabindex="-1"></a><span class="co"># *****</span></span></code></pre></div>
</div>
</div>
<div id="import-igraph" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Importing ego-network data with <code>igraph</code> and <code>tidyverse</code><a href="supplementary.html#import-igraph" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section demonstrates how to import ego-network data into R “manually”, without using <code>egor</code>. The <code>egor</code> packages has simplified many of these operations (see Section <a href="egor.html#egor">7</a>).</p>
<div id="importing-data-for-one-ego-network" class="section level3 hasAnchor" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Importing data for one ego-network<a href="supplementary.html#importing-data-for-one-ego-network" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Different functions exist to create <code>igraph</code> objects from data manually typed in R or (more typically) imported from external data sources – such as adjacency matrices or edge lists in an external csv file. Some of these functions are <code>graph_from_edgelist</code>, <code>graph_from_adjacency_matrix</code>, <code>graph_from_data_frame</code>.</li>
<li>The following code assumes a common format for egocentric data (which, however, may not be the one you have): (1) a dataset with ego attributes for all egos; (2) a dataset with alter attributes for all alters from all egos; (3) a dataset of alter-alter ties with a single edge list for all alters from all egos.</li>
<li><strong>What we do in the following code</strong>.
<ul>
<li>Import an ego-network from 2 csv files: the csv file with the edge list (alter-alter ties) and the csv file with alter attributes for one ego. Convert it to igraph object with alter attributes: <code>graph_from_data_frame()</code>.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="supplementary.html#cb582-1" tabindex="-1"></a><span class="co"># Alter attribute and tie data for one ego-network</span></span>
<span id="cb582-2"><a href="supplementary.html#cb582-2" tabindex="-1"></a><span class="co"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span>
<span id="cb582-3"><a href="supplementary.html#cb582-3" tabindex="-1"></a></span>
<span id="cb582-4"><a href="supplementary.html#cb582-4" tabindex="-1"></a><span class="co"># Create graph with ego-network for ego 28</span></span>
<span id="cb582-5"><a href="supplementary.html#cb582-5" tabindex="-1"></a></span>
<span id="cb582-6"><a href="supplementary.html#cb582-6" tabindex="-1"></a><span class="co"># Get the ego-network of ego ID 28 from an external edge list and a data set</span></span>
<span id="cb582-7"><a href="supplementary.html#cb582-7" tabindex="-1"></a><span class="co"># with alter attributes.</span></span>
<span id="cb582-8"><a href="supplementary.html#cb582-8" tabindex="-1"></a></span>
<span id="cb582-9"><a href="supplementary.html#cb582-9" tabindex="-1"></a><span class="co"># Read in the edge list for ego 28. This is a personal network edge list.</span></span>
<span id="cb582-10"><a href="supplementary.html#cb582-10" tabindex="-1"></a>(elist<span class="fl">.28</span> <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./Data/raw_data/alter_ties_028.csv&quot;</span>))</span></code></pre></div>
<pre><code>## Rows: 259 Columns: 3
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## dbl (3): from, to, weight
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 259 × 3
##     from    to weight
##    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1  2801  2802      1
##  2  2801  2803      1
##  3  2801  2804      1
##  4  2801  2805      1
##  5  2801  2806      1
##  6  2801  2807      1
##  7  2801  2808      1
##  8  2801  2809      1
##  9  2801  2810      1
## 10  2801  2811      1
## # ℹ 249 more rows</code></pre>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="supplementary.html#cb585-1" tabindex="-1"></a><span class="co"># Read in the alter attribute data for ego 28. </span></span>
<span id="cb585-2"><a href="supplementary.html#cb585-2" tabindex="-1"></a>(alter.attr<span class="fl">.28</span> <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./Data/raw_data/alter_attributes_028.csv&quot;</span>))</span></code></pre></div>
<pre><code>## Rows: 45 Columns: 12
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (7): alter.sex, alter.age.cat, alter.rel, alter.nat, alter.res, alter.lo...
## dbl (5): alter_ID, ego_ID, alter_num, alter.clo, alter.age
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 45 × 12
##    alter_ID ego_ID alter_num alter.sex alter.age.cat alter.rel    alter.nat
##       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;        &lt;chr&gt;    
##  1     2801     28         1 Female    51-60         Close family Sri Lanka
##  2     2802     28         2 Male      51-60         Other family Sri Lanka
##  3     2803     28         3 Male      51-60         Close family Sri Lanka
##  4     2804     28         4 Male      60+           Close family Sri Lanka
##  5     2805     28         5 Female    41-50         Close family Sri Lanka
##  6     2806     28         6 Female    60+           Close family Sri Lanka
##  7     2807     28         7 Male      41-50         Other family Sri Lanka
##  8     2808     28         8 Female    36-40         Other family Sri Lanka
##  9     2809     28         9 Female    51-60         Other family Sri Lanka
## 10     2810     28        10 Male      60+           Other family Sri Lanka
## # ℹ 35 more rows
## # ℹ 5 more variables: alter.res &lt;chr&gt;, alter.clo &lt;dbl&gt;, alter.loan &lt;chr&gt;,
## #   alter.fam &lt;chr&gt;, alter.age &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="supplementary.html#cb588-1" tabindex="-1"></a><span class="co"># Convert to graph with vertex attributes.</span></span>
<span id="cb588-2"><a href="supplementary.html#cb588-2" tabindex="-1"></a>gr<span class="fl">.28</span> <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(<span class="at">d=</span> elist<span class="fl">.28</span>, <span class="at">vertices=</span> alter.attr<span class="fl">.28</span>, <span class="at">directed=</span> <span class="cn">FALSE</span>)</span>
<span id="cb588-3"><a href="supplementary.html#cb588-3" tabindex="-1"></a></span>
<span id="cb588-4"><a href="supplementary.html#cb588-4" tabindex="-1"></a><span class="co"># Note directed= FALSE</span></span>
<span id="cb588-5"><a href="supplementary.html#cb588-5" tabindex="-1"></a></span>
<span id="cb588-6"><a href="supplementary.html#cb588-6" tabindex="-1"></a><span class="co"># A network object can be created from an adjacency matrix too: import adjacency</span></span>
<span id="cb588-7"><a href="supplementary.html#cb588-7" tabindex="-1"></a><span class="co"># matrix for ego-network of ego 28.</span></span>
<span id="cb588-8"><a href="supplementary.html#cb588-8" tabindex="-1"></a></span>
<span id="cb588-9"><a href="supplementary.html#cb588-9" tabindex="-1"></a><span class="co"># Read the adjacency matrix.</span></span>
<span id="cb588-10"><a href="supplementary.html#cb588-10" tabindex="-1"></a>adj<span class="fl">.28</span> <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;./Data/raw_data/adj_028.csv&quot;</span>, <span class="at">row.names=</span><span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb588-11"><a href="supplementary.html#cb588-11" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb588-12"><a href="supplementary.html#cb588-12" tabindex="-1"></a><span class="co"># Set column names the same as rownames</span></span>
<span id="cb588-13"><a href="supplementary.html#cb588-13" tabindex="-1"></a><span class="fu">colnames</span>(adj<span class="fl">.28</span>) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(adj<span class="fl">.28</span>)</span>
<span id="cb588-14"><a href="supplementary.html#cb588-14" tabindex="-1"></a></span>
<span id="cb588-15"><a href="supplementary.html#cb588-15" tabindex="-1"></a><span class="co"># Convert to igraph</span></span>
<span id="cb588-16"><a href="supplementary.html#cb588-16" tabindex="-1"></a><span class="fu">graph_from_adjacency_matrix</span>(adj<span class="fl">.28</span>, <span class="at">mode=</span><span class="st">&quot;upper&quot;</span>)</span></code></pre></div>
<pre><code>## IGRAPH 4064587 UN-- 45 283 -- 
## + attr: name (v/c)
## + edges from 4064587 (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2818 2801--2820 2801--2823
## [19] 2801--2825 2801--2827 2801--2828 2801--2829 2801--2829 2801--2831
## [25] 2801--2840 2801--2841 2802--2803 2802--2804 2802--2805 2802--2806
## [31] 2802--2807 2802--2808 2802--2809 2802--2810 2802--2811 2802--2812
## [37] 2802--2813 2802--2815 2802--2823 2802--2831 2802--2840 2802--2841
## [43] 2803--2804 2803--2805 2803--2806 2803--2807 2803--2808 2803--2809
## + ... omitted several edges</code></pre>
</div>
<div id="importing-data-on-many-ego-networks-as-data-frames-and-lists" class="section level3 hasAnchor" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> Importing data on many ego-networks as data frames and lists<a href="supplementary.html#importing-data-on-many-ego-networks-as-data-frames-and-lists" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><strong>Lists</strong> are very convenient objects to store multiple pieces of data, such as multiple adjacency matrices or multiple alter attribute data frames, one for each ego. Once we have all our data pieces (e.g. matrices or data frames) into a single list, we can very easily do two things:
<ul>
<li>Run a function on <em>every</em> piece in batch (see Sections <a href="composition.html#comp-many">4.3</a> and <a href="structure.html#apply-purrr">5.4</a>).</li>
<li>Run a function on <em>all</em> the pieces together, using <code>do.call()</code>. <code>do.call(function, list)</code> executes <code>function</code> using all the elements of <code>list</code> as its arguments.</li>
</ul></li>
<li>In many cases, attributes of all alters from all the egos are stored in a single tabular dataset, e.g., a single csv file (such as <code>alter_attributes.csv</code> in our data). Alter tie data can also be stored in a single csv file, for example as an edge list with an additional column indicating the ego ID (such as <code>alter_ties.csv</code> in our data). Data of this type can be easily imported into R using the <code>read_csv</code> function in tidyverse.</li>
<li>In other cases, alter attributes or alter-alter edge lists are stored in different <code>csv</code> files, one for each ego. These can also be imported using <code>read_csv()</code> within a <code>for</code> loop.</li>
<li>Regardless of the external csv data source, once the data are in R we might want to store them as a single <em>data frame</em> with all alters from all egos, or as a <em>list</em> of separate data frames, one for each ego.
<ul>
<li>While a single data frame is more compact, there are scenarios in which coding is simpler if data for different egos are located in different data frames, and all these data frames are gathered in a list.</li>
</ul></li>
<li>In R it is easy to switch between a single data frame (pooling alters from all egos) and a list (with alters from each ego in a separate data frame)
<ul>
<li>Separate data frames, say <code>df1</code> and <code>df2</code>, can be appended into a single data frame using <code>bind_rows</code>, which stacks their rows together: e.g. <code>bind_rows(df1, df2)</code>. If we have 100 egos, we will want to bind 100 data frames. If the data frames are part of a list, say <code>df.list</code>, this can be done simply as <code>bind_rows(df.list)</code>. The result is a single data frame in which all data from all egos are stacked together by rows. Note that this requires that all data frames in <code>df.list</code> have the same variables with the same names.</li>
<li>A single data frame, say <code>df</code> can be split into a list of data frames (one for each ego) by running <code>split(df, f= df$egoID)</code> – where <code>df$egoID</code> is the variable with the ego IDs. This splits the single data frame into a list of separate data frames, one for each value of <code>egoID</code> (i.e., one for each ego).</li>
</ul></li>
<li>When you store ego data frames into a list, ego IDs can be conveniently saved as <strong>names of list elements</strong> (set via <code>names</code> or <code>set_names</code>). If you’re using <em>numeric</em> ego IDs, you should be careful to the order in which list elements are stored in the list. Depending on the sequence of your numeric ego IDs, the 53rd data frame in the list is not necessarily the data frame of ego ID=53. Thus, you need to keep in mind the difference between <code>list[[53]]</code> (numeric indexing: get the 53rd list element) and <code>list[["53"]]</code> (name indexing: get the list element named “53”).</li>
<li><strong>What we do in the following code</strong>.
<ul>
<li>Import the alter attribute data frame and edge list for all alters from <code>alter_attributes.csv</code> and <code>alter_ties.csv</code>.</li>
<li>Demonstrate how alter attribute data frames and edge lists can be easily split by ego (using <code>split</code>) or combined into a single data frame with all alters (using <code>bind_rows</code>).</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="supplementary.html#cb590-1" tabindex="-1"></a><span class="co"># All ego and alter attributes</span></span>
<span id="cb590-2"><a href="supplementary.html#cb590-2" tabindex="-1"></a><span class="co"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - </span></span>
<span id="cb590-3"><a href="supplementary.html#cb590-3" tabindex="-1"></a></span>
<span id="cb590-4"><a href="supplementary.html#cb590-4" tabindex="-1"></a><span class="co"># Import all ego and alter attributes</span></span>
<span id="cb590-5"><a href="supplementary.html#cb590-5" tabindex="-1"></a></span>
<span id="cb590-6"><a href="supplementary.html#cb590-6" tabindex="-1"></a><span class="co"># Import ego-level data.</span></span>
<span id="cb590-7"><a href="supplementary.html#cb590-7" tabindex="-1"></a>(ego.df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./Data/raw_data/ego_data.csv&quot;</span>))</span></code></pre></div>
<pre><code>## Rows: 102 Columns: 9
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (4): ego.sex, ego.edu, ego.empl.bin, ego.age.cat
## dbl (5): ego_ID, ego.age, ego.arr, ego.inc, empl
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 102 × 9
##    ego_ID ego.sex ego.age ego.arr ego.edu ego.inc  empl ego.empl.bin ego.age.cat
##     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      
##  1     28 Male         61    2008 Second…     350     3 Yes          60+        
##  2     29 Male         38    2000 Primary     900     4 Yes          36-40      
##  3     33 Male         30    2010 Primary     200     3 Yes          26-30      
##  4     35 Male         25    2009 Second…    1000     3 Yes          18-25      
##  5     39 Male         29    2007 Primary       0     1 No           26-30      
##  6     40 Male         56    2008 Second…     950     4 Yes          51-60      
##  7     45 Male         52    1975 Primary    1600     3 Yes          51-60      
##  8     46 Male         35    2002 Second…    1200     4 Yes          31-35      
##  9     47 Male         22    2010 Second…     700     4 Yes          18-25      
## 10     48 Male         51    2007 Primary     950     4 Yes          51-60      
## # ℹ 92 more rows</code></pre>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="supplementary.html#cb593-1" tabindex="-1"></a><span class="co"># Import the csv file with attributes of all alters from all egos.</span></span>
<span id="cb593-2"><a href="supplementary.html#cb593-2" tabindex="-1"></a>(alter.attr.all <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./Data/raw_data/alter_attributes.csv&quot;</span>))</span></code></pre></div>
<pre><code>## Rows: 4590 Columns: 12
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (7): alter.sex, alter.age.cat, alter.rel, alter.nat, alter.res, alter.lo...
## dbl (5): alter_ID, ego_ID, alter_num, alter.clo, alter.age
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 4,590 × 12
##    alter_ID ego_ID alter_num alter.sex alter.age.cat alter.rel    alter.nat
##       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;        &lt;chr&gt;    
##  1     2801     28         1 Female    51-60         Close family Sri Lanka
##  2     2802     28         2 Male      51-60         Other family Sri Lanka
##  3     2803     28         3 Male      51-60         Close family Sri Lanka
##  4     2804     28         4 Male      60+           Close family Sri Lanka
##  5     2805     28         5 Female    41-50         Close family Sri Lanka
##  6     2806     28         6 Female    60+           Close family Sri Lanka
##  7     2807     28         7 Male      41-50         Other family Sri Lanka
##  8     2808     28         8 Female    36-40         Other family Sri Lanka
##  9     2809     28         9 Female    51-60         Other family Sri Lanka
## 10     2810     28        10 Male      60+           Other family Sri Lanka
## # ℹ 4,580 more rows
## # ℹ 5 more variables: alter.res &lt;chr&gt;, alter.clo &lt;dbl&gt;, alter.loan &lt;chr&gt;,
## #   alter.fam &lt;chr&gt;, alter.age &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="supplementary.html#cb596-1" tabindex="-1"></a><span class="co"># Note the number of rows (number of all alters).</span></span>
<span id="cb596-2"><a href="supplementary.html#cb596-2" tabindex="-1"></a></span>
<span id="cb596-3"><a href="supplementary.html#cb596-3" tabindex="-1"></a><span class="co"># We can easily split a single data frame into a list of data frames, with one</span></span>
<span id="cb596-4"><a href="supplementary.html#cb596-4" tabindex="-1"></a><span class="co"># separate element for each ego.</span></span>
<span id="cb596-5"><a href="supplementary.html#cb596-5" tabindex="-1"></a>alter.attr.list <span class="ot">&lt;-</span> <span class="fu">split</span>(alter.attr.all, <span class="at">f=</span> alter.attr.all<span class="sc">$</span>ego_ID)</span>
<span id="cb596-6"><a href="supplementary.html#cb596-6" tabindex="-1"></a></span>
<span id="cb596-7"><a href="supplementary.html#cb596-7" tabindex="-1"></a><span class="co"># The result is a list of N alter attribute data frames, one for each ego.</span></span>
<span id="cb596-8"><a href="supplementary.html#cb596-8" tabindex="-1"></a><span class="fu">length</span>(alter.attr.list)</span></code></pre></div>
<pre><code>## [1] 102</code></pre>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb598-1"><a href="supplementary.html#cb598-1" tabindex="-1"></a><span class="co"># The values of &quot;f&quot; in split() (the split factor) are preserved as list names.</span></span>
<span id="cb598-2"><a href="supplementary.html#cb598-2" tabindex="-1"></a><span class="co"># In our case these are the ego IDs.</span></span>
<span id="cb598-3"><a href="supplementary.html#cb598-3" tabindex="-1"></a><span class="fu">names</span>(alter.attr.list)</span></code></pre></div>
<pre><code>##   [1] &quot;28&quot;  &quot;29&quot;  &quot;33&quot;  &quot;35&quot;  &quot;39&quot;  &quot;40&quot;  &quot;45&quot;  &quot;46&quot;  &quot;47&quot;  &quot;48&quot;  &quot;49&quot;  &quot;51&quot; 
##  [13] &quot;52&quot;  &quot;53&quot;  &quot;55&quot;  &quot;56&quot;  &quot;57&quot;  &quot;58&quot;  &quot;59&quot;  &quot;60&quot;  &quot;61&quot;  &quot;62&quot;  &quot;64&quot;  &quot;65&quot; 
##  [25] &quot;66&quot;  &quot;68&quot;  &quot;69&quot;  &quot;71&quot;  &quot;73&quot;  &quot;74&quot;  &quot;78&quot;  &quot;79&quot;  &quot;80&quot;  &quot;81&quot;  &quot;82&quot;  &quot;83&quot; 
##  [37] &quot;84&quot;  &quot;85&quot;  &quot;86&quot;  &quot;87&quot;  &quot;88&quot;  &quot;90&quot;  &quot;91&quot;  &quot;92&quot;  &quot;93&quot;  &quot;94&quot;  &quot;95&quot;  &quot;97&quot; 
##  [49] &quot;99&quot;  &quot;102&quot; &quot;104&quot; &quot;105&quot; &quot;107&quot; &quot;108&quot; &quot;109&quot; &quot;110&quot; &quot;112&quot; &quot;113&quot; &quot;114&quot; &quot;115&quot;
##  [61] &quot;116&quot; &quot;118&quot; &quot;119&quot; &quot;120&quot; &quot;121&quot; &quot;122&quot; &quot;123&quot; &quot;124&quot; &quot;125&quot; &quot;126&quot; &quot;127&quot; &quot;128&quot;
##  [73] &quot;129&quot; &quot;130&quot; &quot;131&quot; &quot;132&quot; &quot;133&quot; &quot;135&quot; &quot;136&quot; &quot;138&quot; &quot;139&quot; &quot;140&quot; &quot;141&quot; &quot;142&quot;
##  [85] &quot;144&quot; &quot;146&quot; &quot;147&quot; &quot;149&quot; &quot;151&quot; &quot;152&quot; &quot;153&quot; &quot;154&quot; &quot;155&quot; &quot;156&quot; &quot;157&quot; &quot;158&quot;
##  [97] &quot;159&quot; &quot;160&quot; &quot;161&quot; &quot;162&quot; &quot;163&quot; &quot;164&quot;</code></pre>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="supplementary.html#cb600-1" tabindex="-1"></a><span class="co"># The list element is the alter attribute data for a single ego. Get the</span></span>
<span id="cb600-2"><a href="supplementary.html#cb600-2" tabindex="-1"></a><span class="co"># attribute data frame for ego ID 94.</span></span>
<span id="cb600-3"><a href="supplementary.html#cb600-3" tabindex="-1"></a>alter.attr.list[[<span class="st">&quot;94&quot;</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 45 × 12
##    alter_ID ego_ID alter_num alter.sex alter.age.cat alter.rel    alter.nat
##       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;        &lt;chr&gt;    
##  1     9401     94         1 Male      60+           Close family Sri Lanka
##  2     9402     94         2 Female    60+           Close family Sri Lanka
##  3     9403     94         3 Female    26-30         Close family Sri Lanka
##  4     9404     94         4 Male      26-30         Close family Sri Lanka
##  5     9405     94         5 Male      31-35         Close family Sri Lanka
##  6     9406     94         6 Female    60+           Other family Sri Lanka
##  7     9407     94         7 Male      51-60         Other family Sri Lanka
##  8     9408     94         8 Female    36-40         Other family Sri Lanka
##  9     9409     94         9 Female    51-60         Other family Sri Lanka
## 10     9410     94        10 Male      18-25         Other family Sri Lanka
## # ℹ 35 more rows
## # ℹ 5 more variables: alter.res &lt;chr&gt;, alter.clo &lt;dbl&gt;, alter.loan &lt;chr&gt;,
## #   alter.fam &lt;chr&gt;, alter.age &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="supplementary.html#cb602-1" tabindex="-1"></a><span class="co"># The reverse of splitting is also easy to do: if we have N data frames in a</span></span>
<span id="cb602-2"><a href="supplementary.html#cb602-2" tabindex="-1"></a><span class="co"># list, we can easily bind them into a single data frame by stacking their rows</span></span>
<span id="cb602-3"><a href="supplementary.html#cb602-3" tabindex="-1"></a><span class="co"># together.</span></span>
<span id="cb602-4"><a href="supplementary.html#cb602-4" tabindex="-1"></a>alter.attr.all<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(alter.attr.list)</span>
<span id="cb602-5"><a href="supplementary.html#cb602-5" tabindex="-1"></a></span>
<span id="cb602-6"><a href="supplementary.html#cb602-6" tabindex="-1"></a><span class="co"># The result is a single alter-level data frame where each row is an alter, and</span></span>
<span id="cb602-7"><a href="supplementary.html#cb602-7" tabindex="-1"></a><span class="co"># alters from all egos are in the same data frame.</span></span>
<span id="cb602-8"><a href="supplementary.html#cb602-8" tabindex="-1"></a>alter.attr.all<span class="fl">.2</span></span></code></pre></div>
<pre><code>## # A tibble: 4,590 × 12
##    alter_ID ego_ID alter_num alter.sex alter.age.cat alter.rel    alter.nat
##       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;        &lt;chr&gt;    
##  1     2801     28         1 Female    51-60         Close family Sri Lanka
##  2     2802     28         2 Male      51-60         Other family Sri Lanka
##  3     2803     28         3 Male      51-60         Close family Sri Lanka
##  4     2804     28         4 Male      60+           Close family Sri Lanka
##  5     2805     28         5 Female    41-50         Close family Sri Lanka
##  6     2806     28         6 Female    60+           Close family Sri Lanka
##  7     2807     28         7 Male      41-50         Other family Sri Lanka
##  8     2808     28         8 Female    36-40         Other family Sri Lanka
##  9     2809     28         9 Female    51-60         Other family Sri Lanka
## 10     2810     28        10 Male      60+           Other family Sri Lanka
## # ℹ 4,580 more rows
## # ℹ 5 more variables: alter.res &lt;chr&gt;, alter.clo &lt;dbl&gt;, alter.loan &lt;chr&gt;,
## #   alter.fam &lt;chr&gt;, alter.age &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="supplementary.html#cb604-1" tabindex="-1"></a><span class="co"># 45 alters x 102 egos = 4590 alters.</span></span>
<span id="cb604-2"><a href="supplementary.html#cb604-2" tabindex="-1"></a></span>
<span id="cb604-3"><a href="supplementary.html#cb604-3" tabindex="-1"></a><span class="co"># Edge list with alter-alter ties</span></span>
<span id="cb604-4"><a href="supplementary.html#cb604-4" tabindex="-1"></a><span class="co"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - </span></span>
<span id="cb604-5"><a href="supplementary.html#cb604-5" tabindex="-1"></a></span>
<span id="cb604-6"><a href="supplementary.html#cb604-6" tabindex="-1"></a><span class="co"># Let&#39;s import the csv containing a single edge list with alters from all</span></span>
<span id="cb604-7"><a href="supplementary.html#cb604-7" tabindex="-1"></a><span class="co"># egos.</span></span>
<span id="cb604-8"><a href="supplementary.html#cb604-8" tabindex="-1"></a>(elist.all <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./Data/raw_data/alter_ties.csv&quot;</span>))</span></code></pre></div>
<pre><code>## Rows: 30064 Columns: 4
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## dbl (4): from, to, ego_ID, weight
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 30,064 × 4
##     from    to ego_ID weight
##    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1  2801  2802     28      1
##  2  2801  2803     28      1
##  3  2801  2804     28      1
##  4  2801  2805     28      1
##  5  2801  2806     28      1
##  6  2801  2807     28      1
##  7  2801  2808     28      1
##  8  2801  2809     28      1
##  9  2801  2810     28      1
## 10  2801  2811     28      1
## # ℹ 30,054 more rows</code></pre>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="supplementary.html#cb607-1" tabindex="-1"></a><span class="co"># Exactly the same split by ego ID can be done for the edge list with</span></span>
<span id="cb607-2"><a href="supplementary.html#cb607-2" tabindex="-1"></a><span class="co"># alter-alter ties.</span></span>
<span id="cb607-3"><a href="supplementary.html#cb607-3" tabindex="-1"></a>elist.all.list <span class="ot">&lt;-</span> <span class="fu">split</span>(elist.all, <span class="at">f=</span> elist.all<span class="sc">$</span>ego_ID)</span>
<span id="cb607-4"><a href="supplementary.html#cb607-4" tabindex="-1"></a></span>
<span id="cb607-5"><a href="supplementary.html#cb607-5" tabindex="-1"></a><span class="co"># See the result.</span></span>
<span id="cb607-6"><a href="supplementary.html#cb607-6" tabindex="-1"></a><span class="fu">length</span>(elist.all.list)</span></code></pre></div>
<pre><code>## [1] 102</code></pre>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="supplementary.html#cb609-1" tabindex="-1"></a><span class="fu">names</span>(elist.all.list)</span></code></pre></div>
<pre><code>##   [1] &quot;28&quot;  &quot;29&quot;  &quot;33&quot;  &quot;35&quot;  &quot;39&quot;  &quot;40&quot;  &quot;45&quot;  &quot;46&quot;  &quot;47&quot;  &quot;48&quot;  &quot;49&quot;  &quot;51&quot; 
##  [13] &quot;52&quot;  &quot;53&quot;  &quot;55&quot;  &quot;56&quot;  &quot;57&quot;  &quot;58&quot;  &quot;59&quot;  &quot;60&quot;  &quot;61&quot;  &quot;62&quot;  &quot;64&quot;  &quot;65&quot; 
##  [25] &quot;66&quot;  &quot;68&quot;  &quot;69&quot;  &quot;71&quot;  &quot;73&quot;  &quot;74&quot;  &quot;78&quot;  &quot;79&quot;  &quot;80&quot;  &quot;81&quot;  &quot;82&quot;  &quot;83&quot; 
##  [37] &quot;84&quot;  &quot;85&quot;  &quot;86&quot;  &quot;87&quot;  &quot;88&quot;  &quot;90&quot;  &quot;91&quot;  &quot;92&quot;  &quot;93&quot;  &quot;94&quot;  &quot;95&quot;  &quot;97&quot; 
##  [49] &quot;99&quot;  &quot;102&quot; &quot;104&quot; &quot;105&quot; &quot;107&quot; &quot;108&quot; &quot;109&quot; &quot;110&quot; &quot;112&quot; &quot;113&quot; &quot;114&quot; &quot;115&quot;
##  [61] &quot;116&quot; &quot;118&quot; &quot;119&quot; &quot;120&quot; &quot;121&quot; &quot;122&quot; &quot;123&quot; &quot;124&quot; &quot;125&quot; &quot;126&quot; &quot;127&quot; &quot;128&quot;
##  [73] &quot;129&quot; &quot;130&quot; &quot;131&quot; &quot;132&quot; &quot;133&quot; &quot;135&quot; &quot;136&quot; &quot;138&quot; &quot;139&quot; &quot;140&quot; &quot;141&quot; &quot;142&quot;
##  [85] &quot;144&quot; &quot;146&quot; &quot;147&quot; &quot;149&quot; &quot;151&quot; &quot;152&quot; &quot;153&quot; &quot;154&quot; &quot;155&quot; &quot;156&quot; &quot;157&quot; &quot;158&quot;
##  [97] &quot;159&quot; &quot;160&quot; &quot;161&quot; &quot;162&quot; &quot;163&quot; &quot;164&quot;</code></pre>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="supplementary.html#cb611-1" tabindex="-1"></a>elist.all.list[[<span class="st">&quot;94&quot;</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 265 × 4
##     from    to ego_ID weight
##    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1  9401  9402     94      1
##  2  9401  9403     94      1
##  3  9401  9404     94      1
##  4  9401  9405     94      1
##  5  9401  9406     94      1
##  6  9401  9407     94      1
##  7  9401  9408     94      1
##  8  9401  9409     94      1
##  9  9401  9410     94      1
## 10  9401  9411     94      1
## # ℹ 255 more rows</code></pre>
</div>
<div id="creating-lists-of-ego-networks-as-igraph-objects-with-purrr" class="section level3 hasAnchor" number="8.2.3">
<h3><span class="header-section-number">8.2.3</span> Creating lists of ego-networks as <code>igraph</code> objects with <code>purrr</code><a href="supplementary.html#creating-lists-of-ego-networks-as-igraph-objects-with-purrr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><code>purrr::map()</code> is useful when you want to run functions that take a list element as argument, e.g. an <code>igraph</code> ego network; and return another list element as output, e.g. another <code>igraph</code> object. This is the case whenever you want to manipulate the ego networks (e.g. only keep a certain type of ties or vertices), and store the results in a new list.</li>
<li>In certain cases, you want to run a function that takes <em>two</em> arguments from two different lists, say <code>L1</code> and <code>L2</code>, for each ego. For example, for each ego you may want to take its alter-alter edge list (argument 1, from <code>L1</code>), take its alter attributes (argument 2, from <code>L2</code>), and put them together into an <code>igraph</code> object.
<ul>
<li>The function <code>purrr::map2()</code> does this with very little code. For <code>i</code>= 1, …, <em>I</em>, <code>map2()</code> takes the <code>i</code>-th element of <code>L1</code> and the <code>i</code>-th element of <code>L2</code>, and runs your function <em>I</em> times, one for each pair of arguments <code>L1[[i]]</code> and <code>L2[[i]]</code>.</li>
<li>Note that <code>L1</code> and <code>L2</code> need to be two “parallel” lists: the first element of <code>L1</code> corresponds to (will be combined with) the first element of <code>L2</code>; the second element of <code>L1</code> with the second element of <code>L2</code>, …, the <em>I</em>-the element of <code>L1</code> with the <em>I</em>-th element of <code>L2</code>.</li>
<li><code>map2()</code> has a formula notation too: <code>map2(L1, L2, ~ f(.x, .y)</code>, where <code>.x</code> refers to each element of <code>L1</code> and <code>.y</code> refers to each element of <code>L2</code>.</li>
</ul></li>
<li><strong>What we do in the following code</strong>.
<ul>
<li>Use <code>map()</code> to convert each ego’s edge list to an <code>igraph</code> object.</li>
<li>Use <code>map2()</code> to convert each ego’s edge list <em>and</em> alter attribute data frame to an <code>igraph</code> object.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb613-1"><a href="supplementary.html#cb613-1" tabindex="-1"></a><span class="co"># Creating a list of ego-networks as igraph objects</span></span>
<span id="cb613-2"><a href="supplementary.html#cb613-2" tabindex="-1"></a><span class="co"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span>
<span id="cb613-3"><a href="supplementary.html#cb613-3" tabindex="-1"></a></span>
<span id="cb613-4"><a href="supplementary.html#cb613-4" tabindex="-1"></a><span class="co"># We have a list of alter edge lists, with each list element being the edge list </span></span>
<span id="cb613-5"><a href="supplementary.html#cb613-5" tabindex="-1"></a><span class="co"># of one ego.</span></span>
<span id="cb613-6"><a href="supplementary.html#cb613-6" tabindex="-1"></a><span class="fu">length</span>(elist.all.list)</span></code></pre></div>
<pre><code>## [1] 102</code></pre>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb615-1"><a href="supplementary.html#cb615-1" tabindex="-1"></a><span class="fu">names</span>(elist.all.list)</span></code></pre></div>
<pre><code>##   [1] &quot;28&quot;  &quot;29&quot;  &quot;33&quot;  &quot;35&quot;  &quot;39&quot;  &quot;40&quot;  &quot;45&quot;  &quot;46&quot;  &quot;47&quot;  &quot;48&quot;  &quot;49&quot;  &quot;51&quot; 
##  [13] &quot;52&quot;  &quot;53&quot;  &quot;55&quot;  &quot;56&quot;  &quot;57&quot;  &quot;58&quot;  &quot;59&quot;  &quot;60&quot;  &quot;61&quot;  &quot;62&quot;  &quot;64&quot;  &quot;65&quot; 
##  [25] &quot;66&quot;  &quot;68&quot;  &quot;69&quot;  &quot;71&quot;  &quot;73&quot;  &quot;74&quot;  &quot;78&quot;  &quot;79&quot;  &quot;80&quot;  &quot;81&quot;  &quot;82&quot;  &quot;83&quot; 
##  [37] &quot;84&quot;  &quot;85&quot;  &quot;86&quot;  &quot;87&quot;  &quot;88&quot;  &quot;90&quot;  &quot;91&quot;  &quot;92&quot;  &quot;93&quot;  &quot;94&quot;  &quot;95&quot;  &quot;97&quot; 
##  [49] &quot;99&quot;  &quot;102&quot; &quot;104&quot; &quot;105&quot; &quot;107&quot; &quot;108&quot; &quot;109&quot; &quot;110&quot; &quot;112&quot; &quot;113&quot; &quot;114&quot; &quot;115&quot;
##  [61] &quot;116&quot; &quot;118&quot; &quot;119&quot; &quot;120&quot; &quot;121&quot; &quot;122&quot; &quot;123&quot; &quot;124&quot; &quot;125&quot; &quot;126&quot; &quot;127&quot; &quot;128&quot;
##  [73] &quot;129&quot; &quot;130&quot; &quot;131&quot; &quot;132&quot; &quot;133&quot; &quot;135&quot; &quot;136&quot; &quot;138&quot; &quot;139&quot; &quot;140&quot; &quot;141&quot; &quot;142&quot;
##  [85] &quot;144&quot; &quot;146&quot; &quot;147&quot; &quot;149&quot; &quot;151&quot; &quot;152&quot; &quot;153&quot; &quot;154&quot; &quot;155&quot; &quot;156&quot; &quot;157&quot; &quot;158&quot;
##  [97] &quot;159&quot; &quot;160&quot; &quot;161&quot; &quot;162&quot; &quot;163&quot; &quot;164&quot;</code></pre>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="supplementary.html#cb617-1" tabindex="-1"></a>elist.all.list[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 259 × 4
##     from    to ego_ID weight
##    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1  2801  2802     28      1
##  2  2801  2803     28      1
##  3  2801  2804     28      1
##  4  2801  2805     28      1
##  5  2801  2806     28      1
##  6  2801  2807     28      1
##  7  2801  2808     28      1
##  8  2801  2809     28      1
##  9  2801  2810     28      1
## 10  2801  2811     28      1
## # ℹ 249 more rows</code></pre>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="supplementary.html#cb619-1" tabindex="-1"></a><span class="co"># We saw that we can use igraph to convert one ego-network edge list</span></span>
<span id="cb619-2"><a href="supplementary.html#cb619-2" tabindex="-1"></a><span class="co"># to an igraph object. Let&#39;s do it for the first element (i.e., the first ego)</span></span>
<span id="cb619-3"><a href="supplementary.html#cb619-3" tabindex="-1"></a><span class="co"># of elist.all.list.</span></span>
<span id="cb619-4"><a href="supplementary.html#cb619-4" tabindex="-1"></a>elist <span class="ot">&lt;-</span> elist.all.list[[<span class="dv">1</span>]]</span>
<span id="cb619-5"><a href="supplementary.html#cb619-5" tabindex="-1"></a>(gr <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(<span class="at">d=</span> elist, <span class="at">directed=</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<pre><code>## IGRAPH 6a2b8b8 UNW- 45 259 -- 
## + attr: name (v/c), ego_ID (e/n), weight (e/n)
## + edges from 6a2b8b8 (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## [31] 2802--2809 2802--2810 2802--2811 2802--2812 2802--2813 2802--2815
## [37] 2802--2823 2802--2831 2802--2840 2802--2841 2803--2804 2803--2805
## [43] 2803--2806 2803--2807 2803--2808 2803--2809 2803--2810 2803--2811
## + ... omitted several edges</code></pre>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb621-1"><a href="supplementary.html#cb621-1" tabindex="-1"></a><span class="co"># With map(), we can do the same thing for all egos at once.</span></span>
<span id="cb621-2"><a href="supplementary.html#cb621-2" tabindex="-1"></a>gr.list <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x=</span> elist.all.list, </span>
<span id="cb621-3"><a href="supplementary.html#cb621-3" tabindex="-1"></a>                      <span class="sc">~</span> <span class="fu">graph_from_data_frame</span>(<span class="at">d=</span> .x, <span class="at">directed=</span> <span class="cn">FALSE</span>))</span>
<span id="cb621-4"><a href="supplementary.html#cb621-4" tabindex="-1"></a></span>
<span id="cb621-5"><a href="supplementary.html#cb621-5" tabindex="-1"></a><span class="co"># The result is a list of graphs, with each element corresponding to an ego.</span></span>
<span id="cb621-6"><a href="supplementary.html#cb621-6" tabindex="-1"></a></span>
<span id="cb621-7"><a href="supplementary.html#cb621-7" tabindex="-1"></a><span class="co"># The list has as many elements as egos.</span></span>
<span id="cb621-8"><a href="supplementary.html#cb621-8" tabindex="-1"></a><span class="fu">length</span>(gr.list)</span></code></pre></div>
<pre><code>## [1] 102</code></pre>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="supplementary.html#cb623-1" tabindex="-1"></a><span class="co"># The element names are the ego IDs (taken from the names of elist.all.list).</span></span>
<span id="cb623-2"><a href="supplementary.html#cb623-2" tabindex="-1"></a><span class="fu">names</span>(gr.list)</span></code></pre></div>
<pre><code>##   [1] &quot;28&quot;  &quot;29&quot;  &quot;33&quot;  &quot;35&quot;  &quot;39&quot;  &quot;40&quot;  &quot;45&quot;  &quot;46&quot;  &quot;47&quot;  &quot;48&quot;  &quot;49&quot;  &quot;51&quot; 
##  [13] &quot;52&quot;  &quot;53&quot;  &quot;55&quot;  &quot;56&quot;  &quot;57&quot;  &quot;58&quot;  &quot;59&quot;  &quot;60&quot;  &quot;61&quot;  &quot;62&quot;  &quot;64&quot;  &quot;65&quot; 
##  [25] &quot;66&quot;  &quot;68&quot;  &quot;69&quot;  &quot;71&quot;  &quot;73&quot;  &quot;74&quot;  &quot;78&quot;  &quot;79&quot;  &quot;80&quot;  &quot;81&quot;  &quot;82&quot;  &quot;83&quot; 
##  [37] &quot;84&quot;  &quot;85&quot;  &quot;86&quot;  &quot;87&quot;  &quot;88&quot;  &quot;90&quot;  &quot;91&quot;  &quot;92&quot;  &quot;93&quot;  &quot;94&quot;  &quot;95&quot;  &quot;97&quot; 
##  [49] &quot;99&quot;  &quot;102&quot; &quot;104&quot; &quot;105&quot; &quot;107&quot; &quot;108&quot; &quot;109&quot; &quot;110&quot; &quot;112&quot; &quot;113&quot; &quot;114&quot; &quot;115&quot;
##  [61] &quot;116&quot; &quot;118&quot; &quot;119&quot; &quot;120&quot; &quot;121&quot; &quot;122&quot; &quot;123&quot; &quot;124&quot; &quot;125&quot; &quot;126&quot; &quot;127&quot; &quot;128&quot;
##  [73] &quot;129&quot; &quot;130&quot; &quot;131&quot; &quot;132&quot; &quot;133&quot; &quot;135&quot; &quot;136&quot; &quot;138&quot; &quot;139&quot; &quot;140&quot; &quot;141&quot; &quot;142&quot;
##  [85] &quot;144&quot; &quot;146&quot; &quot;147&quot; &quot;149&quot; &quot;151&quot; &quot;152&quot; &quot;153&quot; &quot;154&quot; &quot;155&quot; &quot;156&quot; &quot;157&quot; &quot;158&quot;
##  [97] &quot;159&quot; &quot;160&quot; &quot;161&quot; &quot;162&quot; &quot;163&quot; &quot;164&quot;</code></pre>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="supplementary.html#cb625-1" tabindex="-1"></a><span class="co"># We can extract each ego&#39;s graph.</span></span>
<span id="cb625-2"><a href="supplementary.html#cb625-2" tabindex="-1"></a><span class="co"># By position.</span></span>
<span id="cb625-3"><a href="supplementary.html#cb625-3" tabindex="-1"></a>gr.list[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## IGRAPH e48c4ca UNW- 45 259 -- 
## + attr: name (v/c), ego_ID (e/n), weight (e/n)
## + edges from e48c4ca (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## [31] 2802--2809 2802--2810 2802--2811 2802--2812 2802--2813 2802--2815
## [37] 2802--2823 2802--2831 2802--2840 2802--2841 2803--2804 2803--2805
## [43] 2803--2806 2803--2807 2803--2808 2803--2809 2803--2810 2803--2811
## + ... omitted several edges</code></pre>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="supplementary.html#cb627-1" tabindex="-1"></a><span class="co"># By name (ego ID).</span></span>
<span id="cb627-2"><a href="supplementary.html#cb627-2" tabindex="-1"></a>gr.list[[<span class="st">&quot;94&quot;</span>]]</span></code></pre></div>
<pre><code>## IGRAPH de013c8 UNW- 42 265 -- 
## + attr: name (v/c), ego_ID (e/n), weight (e/n)
## + edges from de013c8 (vertex names):
##  [1] 9401--9402 9401--9403 9401--9404 9401--9405 9401--9406 9401--9407
##  [7] 9401--9408 9401--9409 9401--9410 9401--9411 9401--9412 9401--9413
## [13] 9401--9414 9401--9415 9401--9438 9401--9443 9401--9444 9402--9403
## [19] 9402--9404 9402--9405 9402--9406 9402--9407 9402--9408 9402--9409
## [25] 9402--9410 9402--9411 9402--9412 9402--9413 9402--9414 9402--9415
## [31] 9402--9418 9402--9419 9402--9435 9402--9438 9402--9443 9402--9444
## [37] 9403--9404 9403--9405 9403--9406 9403--9407 9403--9408 9403--9409
## [43] 9403--9410 9403--9411 9403--9412 9403--9413 9403--9414 9403--9415
## + ... omitted several edges</code></pre>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="supplementary.html#cb629-1" tabindex="-1"></a><span class="co"># If we have a function that takes two arguments, we can use map2(). For</span></span>
<span id="cb629-2"><a href="supplementary.html#cb629-2" tabindex="-1"></a><span class="co"># example, graph_from_data_frame() can take two arguments: the ego&#39;s edge list</span></span>
<span id="cb629-3"><a href="supplementary.html#cb629-3" tabindex="-1"></a><span class="co"># and the ego&#39;s alter attribute data frame. </span></span>
<span id="cb629-4"><a href="supplementary.html#cb629-4" tabindex="-1"></a></span>
<span id="cb629-5"><a href="supplementary.html#cb629-5" tabindex="-1"></a><span class="co"># We now have a list of edge lists, one for each ego.</span></span>
<span id="cb629-6"><a href="supplementary.html#cb629-6" tabindex="-1"></a><span class="fu">length</span>(elist.all.list)</span></code></pre></div>
<pre><code>## [1] 102</code></pre>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="supplementary.html#cb631-1" tabindex="-1"></a><span class="co"># And a lsist of alter attribute data frames, one for each ego.</span></span>
<span id="cb631-2"><a href="supplementary.html#cb631-2" tabindex="-1"></a><span class="fu">length</span>(alter.attr.list)</span></code></pre></div>
<pre><code>## [1] 102</code></pre>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="supplementary.html#cb633-1" tabindex="-1"></a><span class="co"># Let&#39;s run graph_from_data_frame() for the first ego, i.e., using the first</span></span>
<span id="cb633-2"><a href="supplementary.html#cb633-2" tabindex="-1"></a><span class="co"># element of each of the two lists.</span></span>
<span id="cb633-3"><a href="supplementary.html#cb633-3" tabindex="-1"></a>(gr <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(<span class="at">d=</span> elist.all.list[[<span class="dv">1</span>]], </span>
<span id="cb633-4"><a href="supplementary.html#cb633-4" tabindex="-1"></a>                             <span class="at">vertices=</span> alter.attr.list[[<span class="dv">1</span>]], <span class="at">directed=</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<pre><code>## IGRAPH 98c7b60 UNW- 45 259 -- 
## + attr: name (v/c), ego_ID (v/n), alter_num (v/n), alter.sex (v/c),
## | alter.age.cat (v/c), alter.rel (v/c), alter.nat (v/c), alter.res
## | (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam (v/c), alter.age
## | (v/n), ego_ID (e/n), weight (e/n)
## + edges from 98c7b60 (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## + ... omitted several edges</code></pre>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="supplementary.html#cb635-1" tabindex="-1"></a><span class="co"># We can now run the same function for all egos at once.</span></span>
<span id="cb635-2"><a href="supplementary.html#cb635-2" tabindex="-1"></a>gr.list <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map2</span>(<span class="at">.x=</span> elist.all.list, <span class="at">.y=</span> alter.attr.list, </span>
<span id="cb635-3"><a href="supplementary.html#cb635-3" tabindex="-1"></a>                       <span class="sc">~</span> <span class="fu">graph_from_data_frame</span>(<span class="at">d=</span> .x, <span class="at">vertices=</span> .y, <span class="at">directed=</span> <span class="cn">FALSE</span>))</span>
<span id="cb635-4"><a href="supplementary.html#cb635-4" tabindex="-1"></a></span>
<span id="cb635-5"><a href="supplementary.html#cb635-5" tabindex="-1"></a><span class="co"># The result is again a list, with each element corresponding to one ego.</span></span></code></pre></div>
</div>
</div>
<div id="more-igraph" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> More operations with <code>igraph</code><a href="supplementary.html#more-igraph" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>More examples of network visualization with <code>igraph</code>.</li>
<li>Add vertices to <code>igraph</code> objects, for example to add the ego node.</li>
</ul>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="supplementary.html#cb636-1" tabindex="-1"></a><span class="co"># Example of network visualization with igraph</span></span>
<span id="cb636-2"><a href="supplementary.html#cb636-2" tabindex="-1"></a><span class="co"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - </span></span>
<span id="cb636-3"><a href="supplementary.html#cb636-3" tabindex="-1"></a></span>
<span id="cb636-4"><a href="supplementary.html#cb636-4" tabindex="-1"></a><span class="co"># Get graph of one ego-network.</span></span>
<span id="cb636-5"><a href="supplementary.html#cb636-5" tabindex="-1"></a>gr <span class="ot">&lt;-</span> gr<span class="fl">.28</span></span>
<span id="cb636-6"><a href="supplementary.html#cb636-6" tabindex="-1"></a></span>
<span id="cb636-7"><a href="supplementary.html#cb636-7" tabindex="-1"></a><span class="co"># Vertex attribute with alter&#39;s country of residence.</span></span>
<span id="cb636-8"><a href="supplementary.html#cb636-8" tabindex="-1"></a><span class="fu">V</span>(gr)<span class="sc">$</span>alter.res</span></code></pre></div>
<pre><code>##  [1] &quot;Sri Lanka&quot; &quot;Sri Lanka&quot; &quot;Sri Lanka&quot; &quot;Sri Lanka&quot; &quot;Sri Lanka&quot; &quot;Sri Lanka&quot;
##  [7] &quot;Sri Lanka&quot; &quot;Sri Lanka&quot; &quot;Sri Lanka&quot; &quot;Sri Lanka&quot; &quot;Sri Lanka&quot; &quot;Sri Lanka&quot;
## [13] &quot;Italy&quot;     &quot;Italy&quot;     &quot;Italy&quot;     &quot;Italy&quot;     &quot;Italy&quot;     &quot;Italy&quot;    
## [19] &quot;Italy&quot;     &quot;Other&quot;     &quot;Italy&quot;     &quot;Italy&quot;     &quot;Italy&quot;     &quot;Italy&quot;    
## [25] &quot;Italy&quot;     &quot;Italy&quot;     &quot;Sri Lanka&quot; &quot;Sri Lanka&quot; &quot;Sri Lanka&quot; &quot;Italy&quot;    
## [31] &quot;Italy&quot;     &quot;Italy&quot;     &quot;Italy&quot;     &quot;Italy&quot;     &quot;Italy&quot;     &quot;Italy&quot;    
## [37] &quot;Italy&quot;     &quot;Italy&quot;     &quot;Italy&quot;     &quot;Sri Lanka&quot; &quot;Sri Lanka&quot; &quot;Italy&quot;    
## [43] &quot;Italy&quot;     &quot;Italy&quot;     &quot;Italy&quot;</code></pre>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb638-1"><a href="supplementary.html#cb638-1" tabindex="-1"></a><span class="co"># Set red as default vertex color.</span></span>
<span id="cb638-2"><a href="supplementary.html#cb638-2" tabindex="-1"></a>color <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&quot;red&quot;</span>, <span class="fu">vcount</span>(gr))</span>
<span id="cb638-3"><a href="supplementary.html#cb638-3" tabindex="-1"></a>color</span></code></pre></div>
<pre><code>##  [1] &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot;
## [13] &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot;
## [25] &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot;
## [37] &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot;</code></pre>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb640-1"><a href="supplementary.html#cb640-1" tabindex="-1"></a><span class="co"># Set color==&quot;blue&quot; when vertex (alter) lives in Italy.</span></span>
<span id="cb640-2"><a href="supplementary.html#cb640-2" tabindex="-1"></a>color[<span class="fu">V</span>(gr)<span class="sc">$</span>alter.res<span class="sc">==</span><span class="st">&quot;Italy&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;blue&quot;</span></span>
<span id="cb640-3"><a href="supplementary.html#cb640-3" tabindex="-1"></a></span>
<span id="cb640-4"><a href="supplementary.html#cb640-4" tabindex="-1"></a><span class="co"># Set color==&quot;green&quot; when vertex (alter) lives in Other country.</span></span>
<span id="cb640-5"><a href="supplementary.html#cb640-5" tabindex="-1"></a>color[<span class="fu">V</span>(gr)<span class="sc">$</span>alter.res<span class="sc">==</span><span class="st">&quot;Other&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;green&quot;</span></span>
<span id="cb640-6"><a href="supplementary.html#cb640-6" tabindex="-1"></a></span>
<span id="cb640-7"><a href="supplementary.html#cb640-7" tabindex="-1"></a><span class="co"># Plot using the &quot;color&quot; vector we just created.</span></span>
<span id="cb640-8"><a href="supplementary.html#cb640-8" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">607</span>)</span>
<span id="cb640-9"><a href="supplementary.html#cb640-9" tabindex="-1"></a><span class="fu">plot</span>(gr, <span class="at">vertex.label=</span> <span class="cn">NA</span>, <span class="at">vertex.size=</span><span class="dv">7</span>, <span class="at">vertex.color=</span> color)</span></code></pre></div>
<p><img src="Egocentric_R_bookdown_files/figure-html/more_igraph-1.png" width="672" /></p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb641-1"><a href="supplementary.html#cb641-1" tabindex="-1"></a><span class="co"># Add ego node to igraph object with igraph operations</span></span>
<span id="cb641-2"><a href="supplementary.html#cb641-2" tabindex="-1"></a><span class="co"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - </span></span>
<span id="cb641-3"><a href="supplementary.html#cb641-3" tabindex="-1"></a></span>
<span id="cb641-4"><a href="supplementary.html#cb641-4" tabindex="-1"></a><span class="co"># Use the + operator to add a named vertex, e.g. ego, to a graph.</span></span>
<span id="cb641-5"><a href="supplementary.html#cb641-5" tabindex="-1"></a>gr.ego <span class="ot">&lt;-</span> gr <span class="sc">+</span> <span class="st">&quot;ego&quot;</span></span>
<span id="cb641-6"><a href="supplementary.html#cb641-6" tabindex="-1"></a></span>
<span id="cb641-7"><a href="supplementary.html#cb641-7" tabindex="-1"></a><span class="co"># The graph has now one more node. It has the same number of edges because we</span></span>
<span id="cb641-8"><a href="supplementary.html#cb641-8" tabindex="-1"></a><span class="co"># haven&#39;t added edges between ego and alters.</span></span>
<span id="cb641-9"><a href="supplementary.html#cb641-9" tabindex="-1"></a><span class="fu">vcount</span>(gr)</span></code></pre></div>
<pre><code>## [1] 45</code></pre>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb643-1"><a href="supplementary.html#cb643-1" tabindex="-1"></a><span class="fu">vcount</span>(gr.ego)</span></code></pre></div>
<pre><code>## [1] 46</code></pre>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="supplementary.html#cb645-1" tabindex="-1"></a><span class="fu">ecount</span>(gr)</span></code></pre></div>
<pre><code>## [1] 259</code></pre>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="supplementary.html#cb647-1" tabindex="-1"></a><span class="fu">ecount</span>(gr.ego)</span></code></pre></div>
<pre><code>## [1] 259</code></pre>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb649-1"><a href="supplementary.html#cb649-1" tabindex="-1"></a><span class="co"># Ego is the 46th vertex.</span></span>
<span id="cb649-2"><a href="supplementary.html#cb649-2" tabindex="-1"></a><span class="fu">V</span>(gr.ego)</span></code></pre></div>
<pre><code>## + 46/46 vertices, named, from ce47506:
##  [1] 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815
## [16] 2816 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830
## [31] 2831 2832 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845
## [46] ego</code></pre>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb651-1"><a href="supplementary.html#cb651-1" tabindex="-1"></a><span class="co"># Let&#39;s add all edges between ego and the alters.</span></span>
<span id="cb651-2"><a href="supplementary.html#cb651-2" tabindex="-1"></a></span>
<span id="cb651-3"><a href="supplementary.html#cb651-3" tabindex="-1"></a><span class="co"># Ego&#39;s adjacency row. Note that the last (46th) cell is the diagonal cell</span></span>
<span id="cb651-4"><a href="supplementary.html#cb651-4" tabindex="-1"></a><span class="co"># between ego and itself.</span></span>
<span id="cb651-5"><a href="supplementary.html#cb651-5" tabindex="-1"></a>gr.ego[<span class="st">&quot;ego&quot;</span>,]</span></code></pre></div>
<pre><code>## 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815 2816 
##    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0 
## 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830 2831 2832 
##    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0 
## 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845  ego 
##    0    0    0    0    0    0    0    0    0    0    0    0    0    0</code></pre>
<div class="sourceCode" id="cb653"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb653-1"><a href="supplementary.html#cb653-1" tabindex="-1"></a><span class="co"># Let&#39;s select ego&#39;s row without the 46th cell: i.e., only cells (ties) between</span></span>
<span id="cb653-2"><a href="supplementary.html#cb653-2" tabindex="-1"></a><span class="co"># ego and the 45 alters. </span></span>
<span id="cb653-3"><a href="supplementary.html#cb653-3" tabindex="-1"></a>gr.ego[<span class="st">&quot;ego&quot;</span>, <span class="sc">-</span><span class="dv">46</span>]</span></code></pre></div>
<pre><code>## 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815 2816 
##    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0 
## 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830 2831 2832 
##    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0 
## 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845 
##    0    0    0    0    0    0    0    0    0    0    0    0    0</code></pre>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb655-1"><a href="supplementary.html#cb655-1" tabindex="-1"></a><span class="co"># Note that we can write this in a more general way, which works for any graph</span></span>
<span id="cb655-2"><a href="supplementary.html#cb655-2" tabindex="-1"></a><span class="co"># regardless of the number of vertices. Creating general code that applies to</span></span>
<span id="cb655-3"><a href="supplementary.html#cb655-3" tabindex="-1"></a><span class="co"># different circumstances is essential when writing R functions.</span></span>
<span id="cb655-4"><a href="supplementary.html#cb655-4" tabindex="-1"></a>gr.ego[<span class="st">&quot;ego&quot;</span>,<span class="sc">-</span><span class="fu">vcount</span>(gr.ego)]</span></code></pre></div>
<pre><code>## 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815 2816 
##    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0 
## 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830 2831 2832 
##    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0 
## 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845 
##    0    0    0    0    0    0    0    0    0    0    0    0    0</code></pre>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb657-1"><a href="supplementary.html#cb657-1" tabindex="-1"></a><span class="co"># Let&#39;s set ego&#39;s entire adjacency row with alters to 1&#39;s. This adds edges</span></span>
<span id="cb657-2"><a href="supplementary.html#cb657-2" tabindex="-1"></a><span class="co"># between ego and all alters.</span></span>
<span id="cb657-3"><a href="supplementary.html#cb657-3" tabindex="-1"></a>gr.ego[<span class="st">&quot;ego&quot;</span>,<span class="sc">-</span><span class="fu">vcount</span>(gr.ego)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb657-4"><a href="supplementary.html#cb657-4" tabindex="-1"></a></span>
<span id="cb657-5"><a href="supplementary.html#cb657-5" tabindex="-1"></a><span class="co"># We now have 45 more edges.</span></span>
<span id="cb657-6"><a href="supplementary.html#cb657-6" tabindex="-1"></a><span class="fu">ecount</span>(gr.ego)</span></code></pre></div>
<pre><code>## [1] 304</code></pre>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb659-1"><a href="supplementary.html#cb659-1" tabindex="-1"></a><span class="co"># See what the ego-network looks like now.</span></span>
<span id="cb659-2"><a href="supplementary.html#cb659-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb659-3"><a href="supplementary.html#cb659-3" tabindex="-1"></a><span class="fu">plot</span>(gr.ego)</span></code></pre></div>
<p><img src="Egocentric_R_bookdown_files/figure-html/more_igraph-2.png" width="672" /></p>
</div>
<div id="statnet" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> The <code>statnet</code> suite of packages<a href="supplementary.html#statnet" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><code>statnet</code> is a collection of different packages. The <code>statnet</code> packages we’ll use in the following code are <code>network</code> and <code>sna</code>.</li>
<li>While <code>igraph</code> represents networks as objects of class <code>igraph</code>, <code>statnet</code> represents networks as objects of class <code>network</code>.</li>
<li>If your network is already stored in an <code>igraph</code> object but you want to analyze it with <code>statnet</code>, you can easily convert the <code>igraph</code> object into a <code>network</code> object using the <code>intergraph</code> package (function <code>asNetwork()</code>). The conversion preserves edge (adjacency) data, vertex attributes, edge attributes, and network attributes.</li>
<li>Of course, you can also create a <code>network</code> object from external data, such as an adjacency matrix stored in a csv file.</li>
<li>Similar to <code>igraph</code>, <code>statnet</code> allows you to import, set and view edge, vertex, and network attributes in addition to edge (adjacency) data.</li>
<li><code>igraph</code> and <code>statnet</code> have overlapping function names. That is, there are <code>igraph</code> functions and <code>statnet</code> functions that have the same name, although they are obviously different functions. For example, both <code>igraph</code> and <code>statnet</code> have a function called <code>degree</code> to calculate vertex degree centrality. When both <code>igraph</code> and <code>statnet</code> are loaded, you should use the <code>package::function()</code> notation to specify which package you want to take the function from (see Section <a href="basics.html#starting-R-and-loading-packages">2.2</a>).</li>
</ul>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb660-1"><a href="supplementary.html#cb660-1" tabindex="-1"></a><span class="co"># Load the statnet package &quot;network&quot; (we use suppressMessages() to avoid</span></span>
<span id="cb660-2"><a href="supplementary.html#cb660-2" tabindex="-1"></a><span class="co"># printing verbose loading messages) and intergraph.</span></span>
<span id="cb660-3"><a href="supplementary.html#cb660-3" tabindex="-1"></a><span class="fu">library</span>(network)</span>
<span id="cb660-4"><a href="supplementary.html#cb660-4" tabindex="-1"></a><span class="fu">library</span>(sna)</span>
<span id="cb660-5"><a href="supplementary.html#cb660-5" tabindex="-1"></a><span class="fu">library</span>(intergraph)</span>
<span id="cb660-6"><a href="supplementary.html#cb660-6" tabindex="-1"></a></span>
<span id="cb660-7"><a href="supplementary.html#cb660-7" tabindex="-1"></a><span class="co"># Let&#39;s convert our ego-network to a statnet &quot;network&quot; object.</span></span>
<span id="cb660-8"><a href="supplementary.html#cb660-8" tabindex="-1"></a>net.gr <span class="ot">&lt;-</span> <span class="fu">asNetwork</span>(gr)</span>
<span id="cb660-9"><a href="supplementary.html#cb660-9" tabindex="-1"></a></span>
<span id="cb660-10"><a href="supplementary.html#cb660-10" tabindex="-1"></a><span class="co"># Check out the object&#39;s class.</span></span>
<span id="cb660-11"><a href="supplementary.html#cb660-11" tabindex="-1"></a><span class="fu">class</span>(net.gr)</span></code></pre></div>
<pre><code>## [1] &quot;network&quot;</code></pre>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb662-1"><a href="supplementary.html#cb662-1" tabindex="-1"></a><span class="co"># Print the object for basic information. Note that vertex and edge attributes</span></span>
<span id="cb662-2"><a href="supplementary.html#cb662-2" tabindex="-1"></a><span class="co"># are correctly imported.</span></span>
<span id="cb662-3"><a href="supplementary.html#cb662-3" tabindex="-1"></a>net.gr</span></code></pre></div>
<pre><code>##  Network attributes:
##   vertices = 45 
##   directed = FALSE 
##   hyper = FALSE 
##   loops = FALSE 
##   multiple = FALSE 
##   bipartite = FALSE 
##   total edges= 259 
##     missing edges= 0 
##     non-missing edges= 259 
## 
##  Vertex attribute names: 
##     alter_num alter.age alter.age.cat alter.clo alter.fam alter.loan alter.nat alter.rel alter.res alter.sex ego_ID vertex.names 
## 
##  Edge attribute names: 
##     weight</code></pre>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb664-1"><a href="supplementary.html#cb664-1" tabindex="-1"></a><span class="co"># Alternatively, we can create a network object from an adjacency matrix.</span></span>
<span id="cb664-2"><a href="supplementary.html#cb664-2" tabindex="-1"></a></span>
<span id="cb664-3"><a href="supplementary.html#cb664-3" tabindex="-1"></a><span class="co"># Adjacency matrix for ego 20</span></span>
<span id="cb664-4"><a href="supplementary.html#cb664-4" tabindex="-1"></a><span class="fu">head</span>(adj<span class="fl">.28</span>)</span></code></pre></div>
<pre><code>##      2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815
## 2801   NA    1    1    1    1    1    1    1    1    1    1    1    1    1    1
## 2802    1   NA    1    1    1    1    1    1    1    1    1    1    1    0    1
## 2803    1    1   NA    1    1    1    1    1    1    1    1    1    0    0    0
## 2804    1    1    1   NA    1    1    1    1    1    1    2    0    0    0    0
## 2805    1    1    1    1   NA    1    1    1    1    1    1    0    0    0    0
## 2806    1    1    1    1    1   NA    1    1    1    1    1    1    0    0    0
##      2816 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830
## 2801    0    0    2    0    1    0    0    1    0    1    0    1    1    2    0
## 2802    0    0    0    0    0    0    0    1    0    0    0    0    0    0    0
## 2803    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0
## 2804    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0
## 2805    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0
## 2806    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0
##      2831 2832 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845
## 2801    1    0    0    0    0    0    0    0    0    1    1    0    0    0    0
## 2802    1    0    0    0    0    0    0    0    0    1    1    0    0    0    0
## 2803    0    0    0    0    0    0    0    0    0    1    1    0    0    0    0
## 2804    0    0    0    0    0    0    0    0    0    2    1    0    0    0    0
## 2805    0    0    0    0    0    0    0    0    0    1    1    0    0    0    0
## 2806    0    0    0    0    0    0    0    0    0    1    1    0    0    0    0</code></pre>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb666-1"><a href="supplementary.html#cb666-1" tabindex="-1"></a><span class="co"># Convert to network object.</span></span>
<span id="cb666-2"><a href="supplementary.html#cb666-2" tabindex="-1"></a>net <span class="ot">&lt;-</span> <span class="fu">as.network</span>(adj<span class="fl">.28</span>, <span class="at">matrix.type =</span> <span class="st">&quot;adjacency&quot;</span>, <span class="at">directed=</span><span class="cn">FALSE</span>, </span>
<span id="cb666-3"><a href="supplementary.html#cb666-3" tabindex="-1"></a>                  <span class="at">ignore.eval=</span><span class="cn">FALSE</span>, <span class="at">names.eval =</span> <span class="st">&quot;weight&quot;</span>)</span>
<span id="cb666-4"><a href="supplementary.html#cb666-4" tabindex="-1"></a></span>
<span id="cb666-5"><a href="supplementary.html#cb666-5" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: </span></span>
<span id="cb666-6"><a href="supplementary.html#cb666-6" tabindex="-1"></a><span class="co"># -- ignore.eval=FALSE imports adjacency cell values as edge attribute.</span></span>
<span id="cb666-7"><a href="supplementary.html#cb666-7" tabindex="-1"></a><span class="co"># -- names.eval = &quot;weight&quot; indicates that the resulting edge attribute should be</span></span>
<span id="cb666-8"><a href="supplementary.html#cb666-8" tabindex="-1"></a><span class="co"># called &quot;weight&quot;.</span></span>
<span id="cb666-9"><a href="supplementary.html#cb666-9" tabindex="-1"></a></span>
<span id="cb666-10"><a href="supplementary.html#cb666-10" tabindex="-1"></a><span class="co"># Print the result. Note that there is only &quot;vertex.names&quot; as vertex attribute.</span></span>
<span id="cb666-11"><a href="supplementary.html#cb666-11" tabindex="-1"></a>net</span></code></pre></div>
<pre><code>##  Network attributes:
##   vertices = 45 
##   directed = FALSE 
##   hyper = FALSE 
##   loops = FALSE 
##   multiple = FALSE 
##   bipartite = FALSE 
##   total edges= 259 
##     missing edges= 0 
##     non-missing edges= 259 
## 
##  Vertex attribute names: 
##     vertex.names 
## 
##  Edge attribute names: 
##     weight</code></pre>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb668-1"><a href="supplementary.html#cb668-1" tabindex="-1"></a><span class="co"># The matrix column names are imported as vertex attribute &quot;vertex name&quot;.</span></span>
<span id="cb668-2"><a href="supplementary.html#cb668-2" tabindex="-1"></a>net <span class="sc">%v%</span> <span class="st">&quot;vertex.names&quot;</span></span></code></pre></div>
<pre><code>##  [1] &quot;2801&quot; &quot;2802&quot; &quot;2803&quot; &quot;2804&quot; &quot;2805&quot; &quot;2806&quot; &quot;2807&quot; &quot;2808&quot; &quot;2809&quot; &quot;2810&quot;
## [11] &quot;2811&quot; &quot;2812&quot; &quot;2813&quot; &quot;2814&quot; &quot;2815&quot; &quot;2816&quot; &quot;2817&quot; &quot;2818&quot; &quot;2819&quot; &quot;2820&quot;
## [21] &quot;2821&quot; &quot;2822&quot; &quot;2823&quot; &quot;2824&quot; &quot;2825&quot; &quot;2826&quot; &quot;2827&quot; &quot;2828&quot; &quot;2829&quot; &quot;2830&quot;
## [31] &quot;2831&quot; &quot;2832&quot; &quot;2833&quot; &quot;2834&quot; &quot;2835&quot; &quot;2836&quot; &quot;2837&quot; &quot;2838&quot; &quot;2839&quot; &quot;2840&quot;
## [41] &quot;2841&quot; &quot;2842&quot; &quot;2843&quot; &quot;2844&quot; &quot;2845&quot;</code></pre>
<div class="sourceCode" id="cb670"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb670-1"><a href="supplementary.html#cb670-1" tabindex="-1"></a><span class="co"># We want to import more vertex attributes. Let&#39;s get alter attributes for ego 28.</span></span>
<span id="cb670-2"><a href="supplementary.html#cb670-2" tabindex="-1"></a>vert.attr <span class="ot">&lt;-</span> alter.attr<span class="fl">.28</span></span>
<span id="cb670-3"><a href="supplementary.html#cb670-3" tabindex="-1"></a></span>
<span id="cb670-4"><a href="supplementary.html#cb670-4" tabindex="-1"></a><span class="co"># We can now take columns from &quot;vert.attr&quot; and set them as attributes. However,</span></span>
<span id="cb670-5"><a href="supplementary.html#cb670-5" tabindex="-1"></a><span class="co"># we first need to make sure that nodes are in the same order in the attribute</span></span>
<span id="cb670-6"><a href="supplementary.html#cb670-6" tabindex="-1"></a><span class="co"># data frame (vert.attr) and in the network object (net).</span></span>
<span id="cb670-7"><a href="supplementary.html#cb670-7" tabindex="-1"></a><span class="fu">identical</span>(net <span class="sc">%v%</span> <span class="st">&quot;vertex.names&quot;</span>, <span class="fu">as.character</span>(vert.attr<span class="sc">$</span>alter_ID))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb672-1"><a href="supplementary.html#cb672-1" tabindex="-1"></a><span class="co"># Let&#39;s import, for example, the sex alter attribute.</span></span>
<span id="cb672-2"><a href="supplementary.html#cb672-2" tabindex="-1"></a><span class="co"># There&#39;s no sex attribute right now in the &quot;net&quot; object.</span></span>
<span id="cb672-3"><a href="supplementary.html#cb672-3" tabindex="-1"></a>net <span class="sc">%v%</span> <span class="st">&quot;alter.sex&quot;</span></span></code></pre></div>
<pre><code>##  [1] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [26] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</code></pre>
<div class="sourceCode" id="cb674"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb674-1"><a href="supplementary.html#cb674-1" tabindex="-1"></a><span class="co"># Let&#39;s set it.</span></span>
<span id="cb674-2"><a href="supplementary.html#cb674-2" tabindex="-1"></a>net <span class="sc">%v%</span> <span class="st">&quot;alter.sex&quot;</span> <span class="ot">&lt;-</span> vert.attr<span class="sc">$</span>alter.sex</span>
<span id="cb674-3"><a href="supplementary.html#cb674-3" tabindex="-1"></a></span>
<span id="cb674-4"><a href="supplementary.html#cb674-4" tabindex="-1"></a></span>
<span id="cb674-5"><a href="supplementary.html#cb674-5" tabindex="-1"></a><span class="co"># Basic statistics: Number of nodes, dyads, edges in the network.</span></span>
<span id="cb674-6"><a href="supplementary.html#cb674-6" tabindex="-1"></a><span class="fu">network.size</span>(net)</span></code></pre></div>
<pre><code>## [1] 45</code></pre>
<div class="sourceCode" id="cb676"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb676-1"><a href="supplementary.html#cb676-1" tabindex="-1"></a><span class="fu">network.dyadcount</span>(net)</span></code></pre></div>
<pre><code>## [1] 990</code></pre>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb678-1"><a href="supplementary.html#cb678-1" tabindex="-1"></a><span class="fu">network.edgecount</span>(net)</span></code></pre></div>
<pre><code>## [1] 259</code></pre>
<div class="sourceCode" id="cb680"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb680-1"><a href="supplementary.html#cb680-1" tabindex="-1"></a><span class="co"># Simple plot</span></span>
<span id="cb680-2"><a href="supplementary.html#cb680-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2106</span>)</span>
<span id="cb680-3"><a href="supplementary.html#cb680-3" tabindex="-1"></a><span class="fu">plot</span>(net)</span></code></pre></div>
<p><img src="Egocentric_R_bookdown_files/figure-html/statnet-1.png" width="672" /></p>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb681-1"><a href="supplementary.html#cb681-1" tabindex="-1"></a><span class="co"># A network object can be indexed as an adjacency matrix.</span></span>
<span id="cb681-2"><a href="supplementary.html#cb681-2" tabindex="-1"></a></span>
<span id="cb681-3"><a href="supplementary.html#cb681-3" tabindex="-1"></a><span class="co"># Adjacency matrix row for alter #3</span></span>
<span id="cb681-4"><a href="supplementary.html#cb681-4" tabindex="-1"></a>net[<span class="dv">3</span>,]</span></code></pre></div>
<pre><code>##  [1] 1 1 0 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [39] 0 1 1 0 0 0 0</code></pre>
<div class="sourceCode" id="cb683"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb683-1"><a href="supplementary.html#cb683-1" tabindex="-1"></a><span class="co"># ...for first 3 alters</span></span>
<span id="cb683-2"><a href="supplementary.html#cb683-2" tabindex="-1"></a>net[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span></code></pre></div>
<pre><code>##      2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815
## 2801    0    1    1    1    1    1    1    1    1    1    1    1    1    1    1
## 2802    1    0    1    1    1    1    1    1    1    1    1    1    1    0    1
## 2803    1    1    0    1    1    1    1    1    1    1    1    1    0    0    0
##      2816 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830
## 2801    0    0    1    0    1    0    0    1    0    1    0    1    1    1    0
## 2802    0    0    0    0    0    0    0    1    0    0    0    0    0    0    0
## 2803    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0
##      2831 2832 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845
## 2801    1    0    0    0    0    0    0    0    0    1    1    0    0    0    0
## 2802    1    0    0    0    0    0    0    0    0    1    1    0    0    0    0
## 2803    0    0    0    0    0    0    0    0    0    1    1    0    0    0    0</code></pre>
<div class="sourceCode" id="cb685"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb685-1"><a href="supplementary.html#cb685-1" tabindex="-1"></a><span class="co"># Get a specific vertex attribute.</span></span>
<span id="cb685-2"><a href="supplementary.html#cb685-2" tabindex="-1"></a>net <span class="sc">%v%</span> <span class="st">&quot;alter.sex&quot;</span></span></code></pre></div>
<pre><code>##  [1] &quot;Female&quot; &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;   &quot;Female&quot; &quot;Female&quot; &quot;Male&quot;   &quot;Female&quot;
##  [9] &quot;Female&quot; &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;  
## [17] &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;  
## [25] &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;   &quot;Female&quot; &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;   &quot;Female&quot;
## [33] &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;   &quot;Female&quot; &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;  
## [41] &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;   &quot;Male&quot;</code></pre>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb687-1"><a href="supplementary.html#cb687-1" tabindex="-1"></a><span class="co"># Get a specific edge attribute.</span></span>
<span id="cb687-2"><a href="supplementary.html#cb687-2" tabindex="-1"></a>net <span class="sc">%e%</span> <span class="st">&quot;weight&quot;</span></span></code></pre></div>
<pre><code>##   [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
##  [38] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
##  [75] 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 2 1
## [112] 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 1
## [149] 1 1 1 1 1 1 1 2 2 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1
## [186] 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 2 1 1 1 1 1 1
## [223] 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1</code></pre>
<div class="sourceCode" id="cb689"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb689-1"><a href="supplementary.html#cb689-1" tabindex="-1"></a><span class="co"># When both igraph and statnet are loaded, you should call their functions using</span></span>
<span id="cb689-2"><a href="supplementary.html#cb689-2" tabindex="-1"></a><span class="co"># the &quot;::&quot; notation.</span></span>
<span id="cb689-3"><a href="supplementary.html#cb689-3" tabindex="-1"></a></span>
<span id="cb689-4"><a href="supplementary.html#cb689-4" tabindex="-1"></a><span class="co"># E.g. there is a &quot;degree()&quot; function both in igraph and statnet (sna package).</span></span>
<span id="cb689-5"><a href="supplementary.html#cb689-5" tabindex="-1"></a><span class="co"># Check out the help for degree: ?degree</span></span>
<span id="cb689-6"><a href="supplementary.html#cb689-6" tabindex="-1"></a></span>
<span id="cb689-7"><a href="supplementary.html#cb689-7" tabindex="-1"></a><span class="co"># If we just call &quot;degree()&quot;, R will take it from the most recently loaded </span></span>
<span id="cb689-8"><a href="supplementary.html#cb689-8" tabindex="-1"></a><span class="co"># package, in this case statnet (sna). This causes an error if degree() is</span></span>
<span id="cb689-9"><a href="supplementary.html#cb689-9" tabindex="-1"></a><span class="co"># applied to an igraph object.</span></span>
<span id="cb689-10"><a href="supplementary.html#cb689-10" tabindex="-1"></a><span class="fu">degree</span>(gr)</span></code></pre></div>
<pre><code>## Error in FUN(X[[i]], ...): as.edgelist.sna input must be an adjacency matrix/array, edgelist matrix, network, or sparse matrix, or list thereof.</code></pre>
<div class="sourceCode" id="cb691"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb691-1"><a href="supplementary.html#cb691-1" tabindex="-1"></a><span class="co"># Let&#39;s specify we want igraph&#39;s degree().</span></span>
<span id="cb691-2"><a href="supplementary.html#cb691-2" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">degree</span>(gr)</span></code></pre></div>
<pre><code>## 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815 2816 
##   24   17   13   12   12   13   13   12   10    9   11    8   18   14   16    9 
## 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830 2831 2832 
##    9   10    2    2    9   18   27   13   10    8    4    3    3    3   15   16 
## 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845 
##   16   12   21    3   10   14   14   16   13    7   12    5   12</code></pre>
<div class="sourceCode" id="cb693"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb693-1"><a href="supplementary.html#cb693-1" tabindex="-1"></a><span class="co"># Before proceeding, let&#39;s un-load the sna package to avoid function name </span></span>
<span id="cb693-2"><a href="supplementary.html#cb693-2" tabindex="-1"></a><span class="co"># overlaps with igraph.</span></span>
<span id="cb693-3"><a href="supplementary.html#cb693-3" tabindex="-1"></a><span class="fu">detach</span>(<span class="st">&quot;package:sna&quot;</span>, <span class="at">unload=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="illustrative-example-personal-networks-of-sri-lankan-immigrants-in-italy" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> Illustrative example: personal networks of Sri Lankan immigrants in Italy<a href="supplementary.html#illustrative-example-personal-networks-of-sri-lankan-immigrants-in-italy" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section, we’ll apply some of the tools presented earlier to a specific case study about the personal networks of Sri Lankan immigrants in Italy. We will demonstrate the use of R in four major tasks of personal network analysis:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Visualization</strong>. We’ll write an R function that plots a personal network with specific graphical parameters. We’ll then run this function on many personal networks and we’ll export the output to an external pdf file.</p></li>
<li><p><strong>Compositional analysis</strong>. We’ll calculate multiple measures on network composition for all our personal networks at once.</p></li>
<li><p><strong>Structural analysis</strong>. We’ll write an R function that calculates multiple structural measures on a personal network and we’ll run it on all the personal networks in our data at once.</p></li>
<li><p><strong>Association with ego-level variables</strong>. We’ll merge the results of personal network compositional and structural analysis with non-network ego-level data, and we’ll analyze the association between ego-level attributes and personal network characteristics.</p></li>
</ol>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="supplementary.html#cb694-1" tabindex="-1"></a><span class="co"># Load package</span></span>
<span id="cb694-2"><a href="supplementary.html#cb694-2" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb694-3"><a href="supplementary.html#cb694-3" tabindex="-1"></a><span class="fu">library</span>(ggraph)</span>
<span id="cb694-4"><a href="supplementary.html#cb694-4" tabindex="-1"></a></span>
<span id="cb694-5"><a href="supplementary.html#cb694-5" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb694-6"><a href="supplementary.html#cb694-6" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;./Data/data.rda&quot;</span>)</span>
<span id="cb694-7"><a href="supplementary.html#cb694-7" tabindex="-1"></a></span>
<span id="cb694-8"><a href="supplementary.html#cb694-8" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb694-9"><a href="supplementary.html#cb694-9" tabindex="-1"></a><span class="co"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - </span></span>
<span id="cb694-10"><a href="supplementary.html#cb694-10" tabindex="-1"></a></span>
<span id="cb694-11"><a href="supplementary.html#cb694-11" tabindex="-1"></a><span class="co"># We want to produce the same kind of plot for all our personal networks, with</span></span>
<span id="cb694-12"><a href="supplementary.html#cb694-12" tabindex="-1"></a><span class="co"># the following characteristics:</span></span>
<span id="cb694-13"><a href="supplementary.html#cb694-13" tabindex="-1"></a><span class="co"># -- Vertices sized by degree centrality.</span></span>
<span id="cb694-14"><a href="supplementary.html#cb694-14" tabindex="-1"></a><span class="co"># -- Sri Lankan alters in red, Italian alters in blue, Other alters in</span></span>
<span id="cb694-15"><a href="supplementary.html#cb694-15" tabindex="-1"></a><span class="co"># grey.</span></span>
<span id="cb694-16"><a href="supplementary.html#cb694-16" tabindex="-1"></a><span class="co"># -- Edges among Sri Lankans in light red, edges among Italians in light blue,</span></span>
<span id="cb694-17"><a href="supplementary.html#cb694-17" tabindex="-1"></a><span class="co"># all other edges in grey.</span></span>
<span id="cb694-18"><a href="supplementary.html#cb694-18" tabindex="-1"></a></span>
<span id="cb694-19"><a href="supplementary.html#cb694-19" tabindex="-1"></a><span class="co"># Let&#39;s first try this on a single ego-network.</span></span>
<span id="cb694-20"><a href="supplementary.html#cb694-20" tabindex="-1"></a></span>
<span id="cb694-21"><a href="supplementary.html#cb694-21" tabindex="-1"></a><span class="co"># Get an ego-network&#39;s igaph object.</span></span>
<span id="cb694-22"><a href="supplementary.html#cb694-22" tabindex="-1"></a>gr <span class="ot">&lt;-</span> gr.list[[<span class="st">&quot;45&quot;</span>]]</span>
<span id="cb694-23"><a href="supplementary.html#cb694-23" tabindex="-1"></a></span>
<span id="cb694-24"><a href="supplementary.html#cb694-24" tabindex="-1"></a><span class="co"># Vertex sequence of Sri Lankans.</span></span>
<span id="cb694-25"><a href="supplementary.html#cb694-25" tabindex="-1"></a>slk <span class="ot">&lt;-</span> <span class="fu">V</span>(gr)[alter.nat<span class="sc">==</span><span class="st">&quot;Sri Lanka&quot;</span>]</span>
<span id="cb694-26"><a href="supplementary.html#cb694-26" tabindex="-1"></a><span class="co"># Vertex sequence of Italians.</span></span>
<span id="cb694-27"><a href="supplementary.html#cb694-27" tabindex="-1"></a>ita <span class="ot">&lt;-</span> <span class="fu">V</span>(gr)[alter.nat<span class="sc">==</span><span class="st">&quot;Italy&quot;</span>]</span>
<span id="cb694-28"><a href="supplementary.html#cb694-28" tabindex="-1"></a><span class="co"># Vertex sequence of Other.</span></span>
<span id="cb694-29"><a href="supplementary.html#cb694-29" tabindex="-1"></a>oth <span class="ot">&lt;-</span> <span class="fu">V</span>(gr)[alter.nat<span class="sc">==</span><span class="st">&quot;Other&quot;</span>]</span>
<span id="cb694-30"><a href="supplementary.html#cb694-30" tabindex="-1"></a></span>
<span id="cb694-31"><a href="supplementary.html#cb694-31" tabindex="-1"></a><span class="co"># Edge attribute indicating which group the edge is between.</span></span>
<span id="cb694-32"><a href="supplementary.html#cb694-32" tabindex="-1"></a><span class="co"># Residual value.</span></span>
<span id="cb694-33"><a href="supplementary.html#cb694-33" tabindex="-1"></a><span class="fu">E</span>(gr)<span class="sc">$</span>edge_between <span class="ot">&lt;-</span> <span class="st">&quot;other&quot;</span></span>
<span id="cb694-34"><a href="supplementary.html#cb694-34" tabindex="-1"></a><span class="co"># Overwrite value for edges among Sri Lankans.</span></span>
<span id="cb694-35"><a href="supplementary.html#cb694-35" tabindex="-1"></a><span class="fu">E</span>(gr)[slk <span class="sc">%--%</span> slk]<span class="sc">$</span>edge_between <span class="ot">&lt;-</span> <span class="st">&quot;slk-slk&quot;</span></span>
<span id="cb694-36"><a href="supplementary.html#cb694-36" tabindex="-1"></a><span class="co"># Overwrite value for edges among Italians.</span></span>
<span id="cb694-37"><a href="supplementary.html#cb694-37" tabindex="-1"></a><span class="fu">E</span>(gr)[ita <span class="sc">%--%</span> ita]<span class="sc">$</span>edge_between <span class="ot">&lt;-</span> <span class="st">&quot;ita-ita&quot;</span></span>
<span id="cb694-38"><a href="supplementary.html#cb694-38" tabindex="-1"></a></span>
<span id="cb694-39"><a href="supplementary.html#cb694-39" tabindex="-1"></a><span class="co"># Calculate degree centrality and set it as vertex attribute in gr.</span></span>
<span id="cb694-40"><a href="supplementary.html#cb694-40" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">degree</span>(gr)</span></code></pre></div>
<pre><code>## 4501 4502 4503 4504 4505 4506 4507 4508 4509 4510 4511 4512 4513 4514 4515 4516 
##   38   14   38    8    7    7   10    9    9    9    9    8    9    8    5    4 
## 4517 4518 4519 4520 4521 4522 4523 4524 4525 4526 4527 4528 4529 4530 4531 4532 
##   10   10    7   15    5    5    3    4    1    5    5    4    8    3    3    3 
## 4533 4534 4535 4536 4537 4538 4539 4540 4541 4542 4543 4544 4545 
##    5    5    5    4    1    5    8   10    9    7    7    8    9</code></pre>
<div class="sourceCode" id="cb696"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb696-1"><a href="supplementary.html#cb696-1" tabindex="-1"></a><span class="fu">V</span>(gr)<span class="sc">$</span>degree <span class="ot">&lt;-</span> igraph<span class="sc">::</span><span class="fu">degree</span>(gr)</span>
<span id="cb696-2"><a href="supplementary.html#cb696-2" tabindex="-1"></a></span>
<span id="cb696-3"><a href="supplementary.html#cb696-3" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb696-4"><a href="supplementary.html#cb696-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">613</span>)</span>
<span id="cb696-5"><a href="supplementary.html#cb696-5" tabindex="-1"></a><span class="fu">ggraph</span>(gr, <span class="at">layout=</span> <span class="st">&quot;fr&quot;</span>) <span class="sc">+</span> </span>
<span id="cb696-6"><a href="supplementary.html#cb696-6" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">color=</span>edge_between), <span class="at">width=</span><span class="dv">1</span>, <span class="at">alpha=</span> <span class="fl">0.7</span>) <span class="sc">+</span> <span class="co"># Edges</span></span>
<span id="cb696-7"><a href="supplementary.html#cb696-7" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">fill=</span>alter.nat, <span class="at">size=</span> degree), <span class="at">shape=</span><span class="dv">21</span>) <span class="sc">+</span> <span class="co"># Nodes</span></span>
<span id="cb696-8"><a href="supplementary.html#cb696-8" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Italy&quot;</span><span class="ot">=</span><span class="st">&quot;blue&quot;</span>, <span class="st">&quot;Sri Lanka&quot;</span><span class="ot">=</span><span class="st">&quot;red&quot;</span>, <span class="st">&quot;Other&quot;</span><span class="ot">=</span><span class="st">&quot;grey&quot;</span>)) <span class="sc">+</span> <span class="co"># Colors for nodes</span></span>
<span id="cb696-9"><a href="supplementary.html#cb696-9" tabindex="-1"></a>  <span class="fu">scale_edge_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;ita-ita&quot;</span><span class="ot">=</span><span class="st">&quot;blue&quot;</span>, <span class="st">&quot;slk-slk&quot;</span><span class="ot">=</span><span class="st">&quot;red&quot;</span>, <span class="st">&quot;other&quot;</span><span class="ot">=</span><span class="st">&quot;grey&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb696-10"><a href="supplementary.html#cb696-10" tabindex="-1"></a>  <span class="co"># Colors for edges</span></span>
<span id="cb696-11"><a href="supplementary.html#cb696-11" tabindex="-1"></a>  <span class="fu">ggtitle</span>(gr<span class="sc">$</span>ego_ID) <span class="sc">+</span> <span class="co"># Ego ID as plot title</span></span>
<span id="cb696-12"><a href="supplementary.html#cb696-12" tabindex="-1"></a>  <span class="fu">theme_graph</span>(<span class="at">base_family =</span> <span class="st">&#39;Helvetica&#39;</span>) <span class="co"># Empty plot theme for network visualizations</span></span></code></pre></div>
<p><img src="Egocentric_R_bookdown_files/figure-html/case-study-1.png" width="70%" /></p>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb697-1"><a href="supplementary.html#cb697-1" tabindex="-1"></a><span class="co"># Let&#39;s now plot the first 10 personal networks. We won&#39;t print the plots in the</span></span>
<span id="cb697-2"><a href="supplementary.html#cb697-2" tabindex="-1"></a><span class="co"># GUI, but we&#39;ll export them to an external pdf file.</span></span>
<span id="cb697-3"><a href="supplementary.html#cb697-3" tabindex="-1"></a></span>
<span id="cb697-4"><a href="supplementary.html#cb697-4" tabindex="-1"></a><span class="co"># Put all the code above in a single function</span></span>
<span id="cb697-5"><a href="supplementary.html#cb697-5" tabindex="-1"></a>my.plot <span class="ot">&lt;-</span> <span class="cf">function</span>(gr) {</span>
<span id="cb697-6"><a href="supplementary.html#cb697-6" tabindex="-1"></a>  </span>
<span id="cb697-7"><a href="supplementary.html#cb697-7" tabindex="-1"></a>  <span class="co"># Vertex sequence of Sri Lankans.</span></span>
<span id="cb697-8"><a href="supplementary.html#cb697-8" tabindex="-1"></a>  slk <span class="ot">&lt;-</span> <span class="fu">V</span>(gr)[alter.nat<span class="sc">==</span><span class="st">&quot;Sri Lanka&quot;</span>]</span>
<span id="cb697-9"><a href="supplementary.html#cb697-9" tabindex="-1"></a>  <span class="co"># Vertex sequence of Italians.</span></span>
<span id="cb697-10"><a href="supplementary.html#cb697-10" tabindex="-1"></a>  ita <span class="ot">&lt;-</span> <span class="fu">V</span>(gr)[alter.nat<span class="sc">==</span><span class="st">&quot;Italy&quot;</span>]</span>
<span id="cb697-11"><a href="supplementary.html#cb697-11" tabindex="-1"></a>  <span class="co"># Vertex sequence of Other.</span></span>
<span id="cb697-12"><a href="supplementary.html#cb697-12" tabindex="-1"></a>  oth <span class="ot">&lt;-</span> <span class="fu">V</span>(gr)[alter.nat<span class="sc">==</span><span class="st">&quot;Other&quot;</span>]</span>
<span id="cb697-13"><a href="supplementary.html#cb697-13" tabindex="-1"></a>  </span>
<span id="cb697-14"><a href="supplementary.html#cb697-14" tabindex="-1"></a>  <span class="co"># Edge attribute indicating which group the edge is between.</span></span>
<span id="cb697-15"><a href="supplementary.html#cb697-15" tabindex="-1"></a>  <span class="co"># Residual value.</span></span>
<span id="cb697-16"><a href="supplementary.html#cb697-16" tabindex="-1"></a>  <span class="fu">E</span>(gr)<span class="sc">$</span>edge_between <span class="ot">&lt;-</span> <span class="st">&quot;other&quot;</span></span>
<span id="cb697-17"><a href="supplementary.html#cb697-17" tabindex="-1"></a>  <span class="co"># Overwrite value for edges among Sri Lankans.</span></span>
<span id="cb697-18"><a href="supplementary.html#cb697-18" tabindex="-1"></a>  <span class="fu">E</span>(gr)[slk <span class="sc">%--%</span> slk]<span class="sc">$</span>edge_between <span class="ot">&lt;-</span> <span class="st">&quot;slk-slk&quot;</span></span>
<span id="cb697-19"><a href="supplementary.html#cb697-19" tabindex="-1"></a>  <span class="co"># Overwrite value for edges among Italians.</span></span>
<span id="cb697-20"><a href="supplementary.html#cb697-20" tabindex="-1"></a>  <span class="fu">E</span>(gr)[ita <span class="sc">%--%</span> ita]<span class="sc">$</span>edge_between <span class="ot">&lt;-</span> <span class="st">&quot;ita-ita&quot;</span></span>
<span id="cb697-21"><a href="supplementary.html#cb697-21" tabindex="-1"></a>  </span>
<span id="cb697-22"><a href="supplementary.html#cb697-22" tabindex="-1"></a>  <span class="co"># Calculate degree centrality and set it as vertex attribute in gr</span></span>
<span id="cb697-23"><a href="supplementary.html#cb697-23" tabindex="-1"></a>  <span class="fu">degree</span>(gr)</span>
<span id="cb697-24"><a href="supplementary.html#cb697-24" tabindex="-1"></a>  <span class="fu">V</span>(gr)<span class="sc">$</span>degree <span class="ot">&lt;-</span> <span class="fu">degree</span>(gr)</span>
<span id="cb697-25"><a href="supplementary.html#cb697-25" tabindex="-1"></a>  </span>
<span id="cb697-26"><a href="supplementary.html#cb697-26" tabindex="-1"></a>  <span class="co"># Plot</span></span>
<span id="cb697-27"><a href="supplementary.html#cb697-27" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">613</span>)</span>
<span id="cb697-28"><a href="supplementary.html#cb697-28" tabindex="-1"></a>  <span class="fu">ggraph</span>(gr, <span class="at">layout=</span> <span class="st">&quot;fr&quot;</span>) <span class="sc">+</span> </span>
<span id="cb697-29"><a href="supplementary.html#cb697-29" tabindex="-1"></a>    <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">color=</span>edge_between), <span class="at">width=</span><span class="dv">1</span>, <span class="at">alpha=</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb697-30"><a href="supplementary.html#cb697-30" tabindex="-1"></a>    <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">fill=</span>alter.nat, <span class="at">size=</span> degree), <span class="at">shape=</span><span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb697-31"><a href="supplementary.html#cb697-31" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Italy&quot;</span><span class="ot">=</span><span class="st">&quot;blue&quot;</span>, <span class="st">&quot;Sri Lanka&quot;</span><span class="ot">=</span><span class="st">&quot;red&quot;</span>, <span class="st">&quot;Other&quot;</span><span class="ot">=</span><span class="st">&quot;grey&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb697-32"><a href="supplementary.html#cb697-32" tabindex="-1"></a>    <span class="fu">scale_edge_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;ita-ita&quot;</span><span class="ot">=</span><span class="st">&quot;blue&quot;</span>, <span class="st">&quot;slk-slk&quot;</span><span class="ot">=</span><span class="st">&quot;red&quot;</span>, <span class="st">&quot;other&quot;</span><span class="ot">=</span><span class="st">&quot;grey&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb697-33"><a href="supplementary.html#cb697-33" tabindex="-1"></a>    <span class="fu">ggtitle</span>(gr<span class="sc">$</span>ego_ID) <span class="sc">+</span></span>
<span id="cb697-34"><a href="supplementary.html#cb697-34" tabindex="-1"></a>    <span class="fu">theme_graph</span>(<span class="at">base_family =</span> <span class="st">&#39;Helvetica&#39;</span>)</span>
<span id="cb697-35"><a href="supplementary.html#cb697-35" tabindex="-1"></a>}</span>
<span id="cb697-36"><a href="supplementary.html#cb697-36" tabindex="-1"></a></span>
<span id="cb697-37"><a href="supplementary.html#cb697-37" tabindex="-1"></a><span class="co"># Run the function we just created on each of the first 10 personal networks</span></span>
<span id="cb697-38"><a href="supplementary.html#cb697-38" tabindex="-1"></a><span class="co"># with a for loop.</span></span>
<span id="cb697-39"><a href="supplementary.html#cb697-39" tabindex="-1"></a></span>
<span id="cb697-40"><a href="supplementary.html#cb697-40" tabindex="-1"></a><span class="co"># Open pdf device</span></span>
<span id="cb697-41"><a href="supplementary.html#cb697-41" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="st">&quot;./Figures/ego_nets_graphs.pdf&quot;</span>)</span>
<span id="cb697-42"><a href="supplementary.html#cb697-42" tabindex="-1"></a></span>
<span id="cb697-43"><a href="supplementary.html#cb697-43" tabindex="-1"></a><span class="co"># For loop to make plot for each i in first 10 ego-networks.</span></span>
<span id="cb697-44"><a href="supplementary.html#cb697-44" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb697-45"><a href="supplementary.html#cb697-45" tabindex="-1"></a>  </span>
<span id="cb697-46"><a href="supplementary.html#cb697-46" tabindex="-1"></a>  <span class="co"># Get the graph from list</span></span>
<span id="cb697-47"><a href="supplementary.html#cb697-47" tabindex="-1"></a>  gr <span class="ot">&lt;-</span> gr.list[[i]]</span>
<span id="cb697-48"><a href="supplementary.html#cb697-48" tabindex="-1"></a>  </span>
<span id="cb697-49"><a href="supplementary.html#cb697-49" tabindex="-1"></a>  <span class="co"># Run the plot function and print (needed for ggplot within a for loop).</span></span>
<span id="cb697-50"><a href="supplementary.html#cb697-50" tabindex="-1"></a>  <span class="fu">my.plot</span>(gr) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb697-51"><a href="supplementary.html#cb697-51" tabindex="-1"></a>}</span>
<span id="cb697-52"><a href="supplementary.html#cb697-52" tabindex="-1"></a></span>
<span id="cb697-53"><a href="supplementary.html#cb697-53" tabindex="-1"></a><span class="co"># Close pdf device</span></span>
<span id="cb697-54"><a href="supplementary.html#cb697-54" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>## quartz_off_screen 
##                 2</code></pre>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb699-1"><a href="supplementary.html#cb699-1" tabindex="-1"></a><span class="co"># Same result, but with tidyverse code:</span></span>
<span id="cb699-2"><a href="supplementary.html#cb699-2" tabindex="-1"></a></span>
<span id="cb699-3"><a href="supplementary.html#cb699-3" tabindex="-1"></a><span class="co"># Open pdf device</span></span>
<span id="cb699-4"><a href="supplementary.html#cb699-4" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="st">&quot;./Figures/ego_nets_graphs.pdf&quot;</span>)</span>
<span id="cb699-5"><a href="supplementary.html#cb699-5" tabindex="-1"></a></span>
<span id="cb699-6"><a href="supplementary.html#cb699-6" tabindex="-1"></a><span class="co"># Get list of ego-networks (first 10 elements)</span></span>
<span id="cb699-7"><a href="supplementary.html#cb699-7" tabindex="-1"></a>gr.list[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>] <span class="sc">|&gt;</span></span>
<span id="cb699-8"><a href="supplementary.html#cb699-8" tabindex="-1"></a>  <span class="co"># walk: similar to map(), but calls a function for its side effects (here,</span></span>
<span id="cb699-9"><a href="supplementary.html#cb699-9" tabindex="-1"></a>  <span class="co"># producing a plot)</span></span>
<span id="cb699-10"><a href="supplementary.html#cb699-10" tabindex="-1"></a>  <span class="fu">walk</span>(<span class="sc">~</span> <span class="fu">my.plot</span>(.x) <span class="sc">|&gt;</span> <span class="fu">print</span>())</span>
<span id="cb699-11"><a href="supplementary.html#cb699-11" tabindex="-1"></a></span>
<span id="cb699-12"><a href="supplementary.html#cb699-12" tabindex="-1"></a><span class="co"># Close pdf device</span></span>
<span id="cb699-13"><a href="supplementary.html#cb699-13" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>## quartz_off_screen 
##                 2</code></pre>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb701-1"><a href="supplementary.html#cb701-1" tabindex="-1"></a><span class="co"># Compositional analysis</span></span>
<span id="cb701-2"><a href="supplementary.html#cb701-2" tabindex="-1"></a><span class="co"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - </span></span>
<span id="cb701-3"><a href="supplementary.html#cb701-3" tabindex="-1"></a></span>
<span id="cb701-4"><a href="supplementary.html#cb701-4" tabindex="-1"></a><span class="co"># Frequency of different nationalities in the personal networks.</span></span>
<span id="cb701-5"><a href="supplementary.html#cb701-5" tabindex="-1"></a></span>
<span id="cb701-6"><a href="supplementary.html#cb701-6" tabindex="-1"></a><span class="co"># Group the pooled alter attribute data frame by ego_ID.</span></span>
<span id="cb701-7"><a href="supplementary.html#cb701-7" tabindex="-1"></a>alter.attr.all <span class="ot">&lt;-</span> alter.attr.all <span class="sc">|&gt;</span> </span>
<span id="cb701-8"><a href="supplementary.html#cb701-8" tabindex="-1"></a>  <span class="fu">group_by</span>(ego_ID)</span>
<span id="cb701-9"><a href="supplementary.html#cb701-9" tabindex="-1"></a></span>
<span id="cb701-10"><a href="supplementary.html#cb701-10" tabindex="-1"></a><span class="co"># Run the compositional measures.</span></span>
<span id="cb701-11"><a href="supplementary.html#cb701-11" tabindex="-1"></a>comp.measures <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">summarise</span>(alter.attr.all, </span>
<span id="cb701-12"><a href="supplementary.html#cb701-12" tabindex="-1"></a>                                  <span class="co"># N Italians</span></span>
<span id="cb701-13"><a href="supplementary.html#cb701-13" tabindex="-1"></a>                                  <span class="at">N.ita=</span> <span class="fu">sum</span>(alter.nat<span class="sc">==</span><span class="st">&quot;Italy&quot;</span>), </span>
<span id="cb701-14"><a href="supplementary.html#cb701-14" tabindex="-1"></a>                                  <span class="co"># N Sri Lankans</span></span>
<span id="cb701-15"><a href="supplementary.html#cb701-15" tabindex="-1"></a>                                  <span class="at">N.slk=</span> <span class="fu">sum</span>(alter.nat<span class="sc">==</span><span class="st">&quot;Sri Lanka&quot;</span>), </span>
<span id="cb701-16"><a href="supplementary.html#cb701-16" tabindex="-1"></a>                                  <span class="co"># N Others</span></span>
<span id="cb701-17"><a href="supplementary.html#cb701-17" tabindex="-1"></a>                                  <span class="at">N.oth=</span> <span class="fu">sum</span>(alter.nat<span class="sc">==</span><span class="st">&quot;Other&quot;</span>))</span>
<span id="cb701-18"><a href="supplementary.html#cb701-18" tabindex="-1"></a></span>
<span id="cb701-19"><a href="supplementary.html#cb701-19" tabindex="-1"></a><span class="co"># Add the relative frequency of Italians.</span></span>
<span id="cb701-20"><a href="supplementary.html#cb701-20" tabindex="-1"></a>comp.measures <span class="ot">&lt;-</span> comp.measures <span class="sc">|&gt;</span> </span>
<span id="cb701-21"><a href="supplementary.html#cb701-21" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop.ita =</span> N.ita<span class="sc">/</span><span class="dv">45</span>)</span>
<span id="cb701-22"><a href="supplementary.html#cb701-22" tabindex="-1"></a></span>
<span id="cb701-23"><a href="supplementary.html#cb701-23" tabindex="-1"></a><span class="co"># Show result.</span></span>
<span id="cb701-24"><a href="supplementary.html#cb701-24" tabindex="-1"></a>comp.measures</span></code></pre></div>
<pre><code>## # A tibble: 102 × 5
##    ego_ID N.ita N.slk N.oth prop.ita
##     &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;
##  1     28     0    43     2   0     
##  2     29     1    44     0   0.0222
##  3     33     2    32    11   0.0444
##  4     35     4    33     8   0.0889
##  5     39     5    39     1   0.111 
##  6     40     1    34    10   0.0222
##  7     45    19    14    12   0.422 
##  8     46     7    33     5   0.156 
##  9     47     0    45     0   0     
## 10     48     4    39     2   0.0889
## # ℹ 92 more rows</code></pre>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb703-1"><a href="supplementary.html#cb703-1" tabindex="-1"></a><span class="co"># Structural analysis</span></span>
<span id="cb703-2"><a href="supplementary.html#cb703-2" tabindex="-1"></a><span class="co"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - </span></span>
<span id="cb703-3"><a href="supplementary.html#cb703-3" tabindex="-1"></a></span>
<span id="cb703-4"><a href="supplementary.html#cb703-4" tabindex="-1"></a><span class="co"># We are going to write a function that takes an igraph object as argument and </span></span>
<span id="cb703-5"><a href="supplementary.html#cb703-5" tabindex="-1"></a><span class="co"># returns 3 values:</span></span>
<span id="cb703-6"><a href="supplementary.html#cb703-6" tabindex="-1"></a><span class="co"># -- The density of ties among Italian alters</span></span>
<span id="cb703-7"><a href="supplementary.html#cb703-7" tabindex="-1"></a><span class="co"># -- The average degree of Italian alters.</span></span>
<span id="cb703-8"><a href="supplementary.html#cb703-8" tabindex="-1"></a><span class="co"># -- The average degree of Italian alters, as a proportion of the overall</span></span>
<span id="cb703-9"><a href="supplementary.html#cb703-9" tabindex="-1"></a><span class="co"># average degree.</span></span>
<span id="cb703-10"><a href="supplementary.html#cb703-10" tabindex="-1"></a></span>
<span id="cb703-11"><a href="supplementary.html#cb703-11" tabindex="-1"></a><span class="co"># Write the function.</span></span>
<span id="cb703-12"><a href="supplementary.html#cb703-12" tabindex="-1"></a>str.ita <span class="ot">&lt;-</span> <span class="cf">function</span>(gr) {</span>
<span id="cb703-13"><a href="supplementary.html#cb703-13" tabindex="-1"></a>  </span>
<span id="cb703-14"><a href="supplementary.html#cb703-14" tabindex="-1"></a>  <span class="co"># Vertex sequence of Italians in the graph.</span></span>
<span id="cb703-15"><a href="supplementary.html#cb703-15" tabindex="-1"></a>  ita <span class="ot">&lt;-</span> <span class="fu">V</span>(gr)[alter.nat<span class="sc">==</span><span class="st">&quot;Italy&quot;</span>]</span>
<span id="cb703-16"><a href="supplementary.html#cb703-16" tabindex="-1"></a>  </span>
<span id="cb703-17"><a href="supplementary.html#cb703-17" tabindex="-1"></a>  <span class="co"># Number of Italians.</span></span>
<span id="cb703-18"><a href="supplementary.html#cb703-18" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(ita)</span>
<span id="cb703-19"><a href="supplementary.html#cb703-19" tabindex="-1"></a>  </span>
<span id="cb703-20"><a href="supplementary.html#cb703-20" tabindex="-1"></a>  <span class="co"># Number of all possible edges among Italians.</span></span>
<span id="cb703-21"><a href="supplementary.html#cb703-21" tabindex="-1"></a>  possible <span class="ot">&lt;-</span> n<span class="sc">*</span>(n<span class="dv">-1</span>)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb703-22"><a href="supplementary.html#cb703-22" tabindex="-1"></a>  </span>
<span id="cb703-23"><a href="supplementary.html#cb703-23" tabindex="-1"></a>  <span class="co"># Actual number of edges among Italians.</span></span>
<span id="cb703-24"><a href="supplementary.html#cb703-24" tabindex="-1"></a>  actual <span class="ot">&lt;-</span> <span class="fu">E</span>(gr)[ita <span class="sc">%--%</span> ita] <span class="sc">|&gt;</span> <span class="fu">length</span>()</span>
<span id="cb703-25"><a href="supplementary.html#cb703-25" tabindex="-1"></a>  <span class="co"># Notice that this is 0 if there are no Italian contacts, i.e. length(ita)==0.</span></span>
<span id="cb703-26"><a href="supplementary.html#cb703-26" tabindex="-1"></a>  </span>
<span id="cb703-27"><a href="supplementary.html#cb703-27" tabindex="-1"></a>  <span class="co"># Density of connections among Italians.</span></span>
<span id="cb703-28"><a href="supplementary.html#cb703-28" tabindex="-1"></a>  dens.ita <span class="ot">&lt;-</span> actual<span class="sc">/</span>possible</span>
<span id="cb703-29"><a href="supplementary.html#cb703-29" tabindex="-1"></a>  <span class="co"># Notice that this is NaN if there are no Italian contacts.</span></span>
<span id="cb703-30"><a href="supplementary.html#cb703-30" tabindex="-1"></a>  </span>
<span id="cb703-31"><a href="supplementary.html#cb703-31" tabindex="-1"></a>  <span class="co"># Average degree of Italian contacts.</span></span>
<span id="cb703-32"><a href="supplementary.html#cb703-32" tabindex="-1"></a>  avg.deg.ita <span class="ot">&lt;-</span> igraph<span class="sc">::</span><span class="fu">degree</span>(gr, <span class="fu">V</span>(gr)[alter.nat<span class="sc">==</span><span class="st">&quot;Italy&quot;</span>]) <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span>
<span id="cb703-33"><a href="supplementary.html#cb703-33" tabindex="-1"></a>  <span class="co"># This is also NaN if there are no Italians.</span></span>
<span id="cb703-34"><a href="supplementary.html#cb703-34" tabindex="-1"></a>  </span>
<span id="cb703-35"><a href="supplementary.html#cb703-35" tabindex="-1"></a>  <span class="co"># Average degree of Italians, as a proportion of overall average degree.</span></span>
<span id="cb703-36"><a href="supplementary.html#cb703-36" tabindex="-1"></a>  avg.deg.ita.prop <span class="ot">&lt;-</span> avg.deg.ita<span class="sc">/</span><span class="fu">mean</span>(igraph<span class="sc">::</span><span class="fu">degree</span>(gr))</span>
<span id="cb703-37"><a href="supplementary.html#cb703-37" tabindex="-1"></a>  <span class="co"># This is also NaN if there are no Italians. </span></span>
<span id="cb703-38"><a href="supplementary.html#cb703-38" tabindex="-1"></a>  </span>
<span id="cb703-39"><a href="supplementary.html#cb703-39" tabindex="-1"></a>  <span class="co"># Return the 3 results as a tibble</span></span>
<span id="cb703-40"><a href="supplementary.html#cb703-40" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">dens.ita =</span> dens.ita, </span>
<span id="cb703-41"><a href="supplementary.html#cb703-41" tabindex="-1"></a>         <span class="at">avg.deg.ita =</span> avg.deg.ita, </span>
<span id="cb703-42"><a href="supplementary.html#cb703-42" tabindex="-1"></a>         <span class="at">avg.deg.ita.prop =</span> avg.deg.ita.prop)</span>
<span id="cb703-43"><a href="supplementary.html#cb703-43" tabindex="-1"></a>}</span>
<span id="cb703-44"><a href="supplementary.html#cb703-44" tabindex="-1"></a></span>
<span id="cb703-45"><a href="supplementary.html#cb703-45" tabindex="-1"></a><span class="co"># Run the function on all personal networks.</span></span>
<span id="cb703-46"><a href="supplementary.html#cb703-46" tabindex="-1"></a>(str.ita.df <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(gr.list, str.ita, <span class="at">.id=</span> <span class="st">&quot;ego_ID&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 102 × 4
##    ego_ID dens.ita avg.deg.ita avg.deg.ita.prop
##    &lt;chr&gt;     &lt;dbl&gt;       &lt;dbl&gt;            &lt;dbl&gt;
##  1 28      NaN          NaN             NaN    
##  2 29      NaN            0               0    
##  3 33        1            1               0.109
##  4 35        0            3.25            0.331
##  5 39        0            0               0    
##  6 40      NaN            3               0.265
##  7 45        0.193        6.11            0.751
##  8 46        0.571       10.7             0.903
##  9 47      NaN          NaN             NaN    
## 10 48        1            5               0.560
## # ℹ 92 more rows</code></pre>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="supplementary.html#cb705-1" tabindex="-1"></a><span class="co"># Convert ego_ID from character to numeric for consistency with ego attribute</span></span>
<span id="cb705-2"><a href="supplementary.html#cb705-2" tabindex="-1"></a><span class="co"># data.</span></span>
<span id="cb705-3"><a href="supplementary.html#cb705-3" tabindex="-1"></a>str.ita.df <span class="ot">&lt;-</span> str.ita.df <span class="sc">|&gt;</span> </span>
<span id="cb705-4"><a href="supplementary.html#cb705-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ego_ID =</span> <span class="fu">as.numeric</span>(ego_ID))</span>
<span id="cb705-5"><a href="supplementary.html#cb705-5" tabindex="-1"></a></span>
<span id="cb705-6"><a href="supplementary.html#cb705-6" tabindex="-1"></a><span class="co"># Association with ego-level variables</span></span>
<span id="cb705-7"><a href="supplementary.html#cb705-7" tabindex="-1"></a><span class="co"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - </span></span>
<span id="cb705-8"><a href="supplementary.html#cb705-8" tabindex="-1"></a></span>
<span id="cb705-9"><a href="supplementary.html#cb705-9" tabindex="-1"></a><span class="co"># Ego attribute data</span></span>
<span id="cb705-10"><a href="supplementary.html#cb705-10" tabindex="-1"></a>ego.df</span></code></pre></div>
<pre><code>## # A tibble: 102 × 9
##    ego_ID ego.sex ego.age ego.arr ego.edu ego.inc  empl ego.empl.bin ego.age.cat
##     &lt;dbl&gt; &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;        &lt;fct&gt;      
##  1     28 Male         61    2008 Second…     350     3 Yes          60+        
##  2     29 Male         38    2000 Primary     900     4 Yes          36-40      
##  3     33 Male         30    2010 Primary     200     3 Yes          26-30      
##  4     35 Male         25    2009 Second…    1000     3 Yes          18-25      
##  5     39 Male         29    2007 Primary       0     1 No           26-30      
##  6     40 Male         56    2008 Second…     950     4 Yes          51-60      
##  7     45 Male         52    1975 Primary    1600     3 Yes          51-60      
##  8     46 Male         35    2002 Second…    1200     4 Yes          31-35      
##  9     47 Male         22    2010 Second…     700     4 Yes          18-25      
## 10     48 Male         51    2007 Primary     950     4 Yes          51-60      
## # ℹ 92 more rows</code></pre>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb707-1"><a href="supplementary.html#cb707-1" tabindex="-1"></a><span class="co"># Join ego-level data with compositional variables obtained above.</span></span>
<span id="cb707-2"><a href="supplementary.html#cb707-2" tabindex="-1"></a>ego.df <span class="ot">&lt;-</span> ego.df <span class="sc">|&gt;</span> </span>
<span id="cb707-3"><a href="supplementary.html#cb707-3" tabindex="-1"></a>  <span class="fu">left_join</span>(comp.measures, <span class="at">by=</span> <span class="st">&quot;ego_ID&quot;</span>)</span>
<span id="cb707-4"><a href="supplementary.html#cb707-4" tabindex="-1"></a></span>
<span id="cb707-5"><a href="supplementary.html#cb707-5" tabindex="-1"></a><span class="co"># Merge ego-level data with structural variables obtained above.</span></span>
<span id="cb707-6"><a href="supplementary.html#cb707-6" tabindex="-1"></a>ego.df <span class="ot">&lt;-</span> ego.df <span class="sc">|&gt;</span> </span>
<span id="cb707-7"><a href="supplementary.html#cb707-7" tabindex="-1"></a>  <span class="fu">left_join</span>(str.ita.df, <span class="at">by=</span> <span class="st">&quot;ego_ID&quot;</span>)</span>
<span id="cb707-8"><a href="supplementary.html#cb707-8" tabindex="-1"></a></span>
<span id="cb707-9"><a href="supplementary.html#cb707-9" tabindex="-1"></a><span class="co"># See the result (just a subset of the variables)</span></span>
<span id="cb707-10"><a href="supplementary.html#cb707-10" tabindex="-1"></a>ego.df <span class="sc">|&gt;</span> </span>
<span id="cb707-11"><a href="supplementary.html#cb707-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ego_ID, ego.sex, ego.age, N.slk, prop.ita, dens.ita)</span></code></pre></div>
<pre><code>## # A tibble: 102 × 6
##    ego_ID ego.sex ego.age N.slk prop.ita dens.ita
##     &lt;dbl&gt; &lt;fct&gt;     &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1     28 Male         61    43   0       NaN    
##  2     29 Male         38    44   0.0222  NaN    
##  3     33 Male         30    32   0.0444    1    
##  4     35 Male         25    33   0.0889    0    
##  5     39 Male         29    39   0.111     0    
##  6     40 Male         56    34   0.0222  NaN    
##  7     45 Male         52    14   0.422     0.193
##  8     46 Male         35    33   0.156     0.571
##  9     47 Male         22    45   0       NaN    
## 10     48 Male         51    39   0.0889    1    
## # ℹ 92 more rows</code></pre>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="supplementary.html#cb709-1" tabindex="-1"></a><span class="co"># Plot number by mean degree of Italians.</span></span>
<span id="cb709-2"><a href="supplementary.html#cb709-2" tabindex="-1"></a><span class="co"># To avoid warnings from ggplot(), let&#39;s remove cases with NA values on the</span></span>
<span id="cb709-3"><a href="supplementary.html#cb709-3" tabindex="-1"></a><span class="co"># relevant variables.</span></span>
<span id="cb709-4"><a href="supplementary.html#cb709-4" tabindex="-1"></a>data <span class="ot">&lt;-</span> ego.df <span class="sc">|&gt;</span> </span>
<span id="cb709-5"><a href="supplementary.html#cb709-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(N.ita, avg.deg.ita))</span>
<span id="cb709-6"><a href="supplementary.html#cb709-6" tabindex="-1"></a></span>
<span id="cb709-7"><a href="supplementary.html#cb709-7" tabindex="-1"></a><span class="co"># Set seed for reproducibility (jittering is random).</span></span>
<span id="cb709-8"><a href="supplementary.html#cb709-8" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">613</span>)</span>
<span id="cb709-9"><a href="supplementary.html#cb709-9" tabindex="-1"></a><span class="co"># Get and save plot</span></span>
<span id="cb709-10"><a href="supplementary.html#cb709-10" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span> data, <span class="fu">aes</span>(<span class="at">x=</span> N.ita, <span class="at">y=</span> avg.deg.ita)) <span class="sc">+</span> </span>
<span id="cb709-11"><a href="supplementary.html#cb709-11" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">1.5</span>, <span class="at">alpha=</span><span class="fl">0.4</span>, <span class="at">position=</span><span class="fu">position_jitter</span>(<span class="at">height=</span><span class="fl">0.5</span>, <span class="at">width=</span><span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb709-12"><a href="supplementary.html#cb709-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">&quot;N Italians&quot;</span>, <span class="at">y=</span> <span class="st">&quot;Mean degree of Italians&quot;</span>)</span>
<span id="cb709-13"><a href="supplementary.html#cb709-13" tabindex="-1"></a><span class="co"># Note that we slightly jitter the points to avoid overplotting.</span></span>
<span id="cb709-14"><a href="supplementary.html#cb709-14" tabindex="-1"></a><span class="co"># Print plot.</span></span>
<span id="cb709-15"><a href="supplementary.html#cb709-15" tabindex="-1"></a><span class="fu">print</span>(p)</span></code></pre></div>
<p><img src="Egocentric_R_bookdown_files/figure-html/case-study-2.png" width="70%" /></p>
<div class="sourceCode" id="cb710"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb710-1"><a href="supplementary.html#cb710-1" tabindex="-1"></a><span class="co"># Same as above, but with ego_IDs as labels to identify the egos.</span></span>
<span id="cb710-2"><a href="supplementary.html#cb710-2" tabindex="-1"></a><span class="co"># Set seed for reproducibility (jittering is random).</span></span>
<span id="cb710-3"><a href="supplementary.html#cb710-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">613</span>)</span>
<span id="cb710-4"><a href="supplementary.html#cb710-4" tabindex="-1"></a><span class="co"># Get and save plot</span></span>
<span id="cb710-5"><a href="supplementary.html#cb710-5" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span> data, <span class="fu">aes</span>(<span class="at">x=</span> N.ita, <span class="at">y=</span> avg.deg.ita)) <span class="sc">+</span> </span>
<span id="cb710-6"><a href="supplementary.html#cb710-6" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span> ego_ID), <span class="at">size=</span><span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.7</span>, </span>
<span id="cb710-7"><a href="supplementary.html#cb710-7" tabindex="-1"></a>            <span class="at">position=</span><span class="fu">position_jitter</span>(<span class="at">height=</span><span class="fl">0.5</span>, <span class="at">width=</span><span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb710-8"><a href="supplementary.html#cb710-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">&quot;N Italians&quot;</span>, <span class="at">y=</span> <span class="st">&quot;Mean degree of Italians&quot;</span>)</span>
<span id="cb710-9"><a href="supplementary.html#cb710-9" tabindex="-1"></a><span class="co"># Note that we slightly jitter the labels with position_jitter() so that egoIDs</span></span>
<span id="cb710-10"><a href="supplementary.html#cb710-10" tabindex="-1"></a><span class="co"># don&#39;t overlap and are more readable.</span></span>
<span id="cb710-11"><a href="supplementary.html#cb710-11" tabindex="-1"></a><span class="co"># Print plot.</span></span>
<span id="cb710-12"><a href="supplementary.html#cb710-12" tabindex="-1"></a><span class="fu">print</span>(p)</span></code></pre></div>
<p><img src="Egocentric_R_bookdown_files/figure-html/case-study-3.png" width="70%" /></p>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb711-1"><a href="supplementary.html#cb711-1" tabindex="-1"></a><span class="co"># Same as above, with color representing ego&#39;s educational level.</span></span>
<span id="cb711-2"><a href="supplementary.html#cb711-2" tabindex="-1"></a><span class="co"># Set seed for reproducibility (jittering is random).</span></span>
<span id="cb711-3"><a href="supplementary.html#cb711-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">613</span>)</span>
<span id="cb711-4"><a href="supplementary.html#cb711-4" tabindex="-1"></a><span class="co"># Get and save plot</span></span>
<span id="cb711-5"><a href="supplementary.html#cb711-5" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span> data, <span class="fu">aes</span>(<span class="at">x=</span> N.ita, <span class="at">y=</span> avg.deg.ita)) <span class="sc">+</span> </span>
<span id="cb711-6"><a href="supplementary.html#cb711-6" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">1.5</span>, <span class="fu">aes</span>(<span class="at">color=</span> <span class="fu">as.factor</span>(ego.edu)), </span>
<span id="cb711-7"><a href="supplementary.html#cb711-7" tabindex="-1"></a>             <span class="at">position=</span><span class="fu">position_jitter</span>(<span class="at">height=</span><span class="fl">0.5</span>, <span class="at">width=</span><span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb711-8"><a href="supplementary.html#cb711-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span> </span>
<span id="cb711-9"><a href="supplementary.html#cb711-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">&quot;N Italians&quot;</span>, <span class="at">y=</span> <span class="st">&quot;Mean degree of Italians&quot;</span>, <span class="at">color=</span> <span class="st">&quot;Education&quot;</span>)</span>
<span id="cb711-10"><a href="supplementary.html#cb711-10" tabindex="-1"></a><span class="co"># Note that we slightly jitter the points to avoid overplotting.</span></span>
<span id="cb711-11"><a href="supplementary.html#cb711-11" tabindex="-1"></a><span class="co"># Print plot.</span></span>
<span id="cb711-12"><a href="supplementary.html#cb711-12" tabindex="-1"></a><span class="fu">print</span>(p)</span></code></pre></div>
<p><img src="Egocentric_R_bookdown_files/figure-html/case-study-4.png" width="70%" /></p>
<div class="sourceCode" id="cb712"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb712-1"><a href="supplementary.html#cb712-1" tabindex="-1"></a><span class="co"># Do Sri Lankans who arrived to Italy more recently have fewer Italian contacts</span></span>
<span id="cb712-2"><a href="supplementary.html#cb712-2" tabindex="-1"></a><span class="co"># in their personal network?</span></span>
<span id="cb712-3"><a href="supplementary.html#cb712-3" tabindex="-1"></a></span>
<span id="cb712-4"><a href="supplementary.html#cb712-4" tabindex="-1"></a><span class="co"># To avoid warnings from ggplot(), let&#39;s remove cases with NA values on the</span></span>
<span id="cb712-5"><a href="supplementary.html#cb712-5" tabindex="-1"></a><span class="co"># relevant variables.</span></span>
<span id="cb712-6"><a href="supplementary.html#cb712-6" tabindex="-1"></a>data <span class="ot">&lt;-</span> ego.df <span class="sc">|&gt;</span> </span>
<span id="cb712-7"><a href="supplementary.html#cb712-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(ego.arr, prop.ita))</span>
<span id="cb712-8"><a href="supplementary.html#cb712-8" tabindex="-1"></a></span>
<span id="cb712-9"><a href="supplementary.html#cb712-9" tabindex="-1"></a><span class="co"># Set seed for reproducibility (jittering is random).</span></span>
<span id="cb712-10"><a href="supplementary.html#cb712-10" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">613</span>)</span>
<span id="cb712-11"><a href="supplementary.html#cb712-11" tabindex="-1"></a><span class="co"># Get and save plot</span></span>
<span id="cb712-12"><a href="supplementary.html#cb712-12" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span> data, <span class="fu">aes</span>(<span class="at">x=</span> ego.arr, <span class="at">y=</span> prop.ita)) <span class="sc">+</span> </span>
<span id="cb712-13"><a href="supplementary.html#cb712-13" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span> <span class="dv">1</span>, <span class="at">size=</span> <span class="fl">1.5</span>, <span class="at">position=</span> <span class="fu">position_jitter</span>(<span class="at">width=</span> <span class="dv">1</span>, <span class="at">height=</span> <span class="fl">0.01</span>)) <span class="sc">+</span> </span>
<span id="cb712-14"><a href="supplementary.html#cb712-14" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;loess&quot;</span>) <span class="sc">+</span> </span>
<span id="cb712-15"><a href="supplementary.html#cb712-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">&quot;Year of arrival in Italy&quot;</span>, <span class="at">y=</span> <span class="st">&quot;Prop Italians in personal network&quot;</span>)</span>
<span id="cb712-16"><a href="supplementary.html#cb712-16" tabindex="-1"></a><span class="co"># Print plot.</span></span>
<span id="cb712-17"><a href="supplementary.html#cb712-17" tabindex="-1"></a><span class="fu">print</span>(p)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="Egocentric_R_bookdown_files/figure-html/case-study-5.png" width="70%" /></p>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb714-1"><a href="supplementary.html#cb714-1" tabindex="-1"></a><span class="co"># Do Sri Lankans with more Italian contacts in their personal network have higher</span></span>
<span id="cb714-2"><a href="supplementary.html#cb714-2" tabindex="-1"></a><span class="co"># income?</span></span>
<span id="cb714-3"><a href="supplementary.html#cb714-3" tabindex="-1"></a></span>
<span id="cb714-4"><a href="supplementary.html#cb714-4" tabindex="-1"></a><span class="co"># To avoid warnings from ggplot(), let&#39;s remove cases with NA values on the</span></span>
<span id="cb714-5"><a href="supplementary.html#cb714-5" tabindex="-1"></a><span class="co"># relevant variables.</span></span>
<span id="cb714-6"><a href="supplementary.html#cb714-6" tabindex="-1"></a>data <span class="ot">&lt;-</span> ego.df <span class="sc">|&gt;</span></span>
<span id="cb714-7"><a href="supplementary.html#cb714-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(prop.ita, ego.inc))</span>
<span id="cb714-8"><a href="supplementary.html#cb714-8" tabindex="-1"></a></span>
<span id="cb714-9"><a href="supplementary.html#cb714-9" tabindex="-1"></a><span class="co"># Set seed for reproducibility (jittering is random).</span></span>
<span id="cb714-10"><a href="supplementary.html#cb714-10" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">613</span>)</span>
<span id="cb714-11"><a href="supplementary.html#cb714-11" tabindex="-1"></a><span class="co"># Get and save plot</span></span>
<span id="cb714-12"><a href="supplementary.html#cb714-12" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span> data, <span class="fu">aes</span>(<span class="at">x=</span> prop.ita, <span class="at">y=</span> ego.inc)) <span class="sc">+</span> </span>
<span id="cb714-13"><a href="supplementary.html#cb714-13" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width=</span> <span class="fl">0.01</span>, <span class="at">height=</span> <span class="dv">50</span>, <span class="at">shape=</span> <span class="dv">1</span>, <span class="at">size=</span> <span class="fl">1.5</span>) <span class="sc">+</span> </span>
<span id="cb714-14"><a href="supplementary.html#cb714-14" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;loess&quot;</span>) <span class="sc">+</span> </span>
<span id="cb714-15"><a href="supplementary.html#cb714-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">&quot;Prop Italians in personal network&quot;</span>, <span class="at">y=</span> <span class="st">&quot;Monthly income&quot;</span>)</span>
<span id="cb714-16"><a href="supplementary.html#cb714-16" tabindex="-1"></a><span class="do">## Print plot.</span></span>
<span id="cb714-17"><a href="supplementary.html#cb714-17" tabindex="-1"></a><span class="fu">print</span>(p)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="Egocentric_R_bookdown_files/figure-html/case-study-6.png" width="70%" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="egor.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Egocentric_R_bookdown.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
